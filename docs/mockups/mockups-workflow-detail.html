<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rexera 2.0 - Workflow Detail: PAY-0891</title>
    <style>
        :root {
            /* Rexera Brand Color Palette */
            --primary: #64B6AC;
            --primary-dark: #5a9f95;
            --primary-light: #8cc8c0;
            
            /* Agent Colors - More modern/muted */
            --agent-nina: #8b5cf6;
            --agent-mia: #059669;
            --agent-florian: #ea580c;
            --agent-rex: #64B6AC;
            --agent-iris: #db2777;
            --agent-ria: #0891b2;
            --agent-kosha: #65a30d;
            --agent-cassy: #dc2626;
            --agent-max: #8b5cf6;
            --agent-corey: #06b6d4;
            
            /* Status Colors */
            --critical: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #6b7280;
        }

        /* Light Mode (Default) */
        :root, [data-theme="light"] {
            /* Modern Grays */
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            
            /* Surface colors */
            --bg-primary: #ffffff;
            --bg-secondary: var(--gray-50);
            --bg-tertiary: var(--gray-100);
            --surface: #ffffff;
            --surface-elevated: #ffffff;
            
            /* Text colors */
            --text-primary: var(--gray-900);
            --text-secondary: var(--gray-600);
            --text-tertiary: var(--gray-500);
            
            /* Border colors */
            --border: var(--gray-200);
            --border-light: var(--gray-100);
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        /* Dark Mode */
        [data-theme="dark"] {
            /* Dark Mode Grays */
            --gray-50: #0f172a;
            --gray-100: #1e293b;
            --gray-200: #334155;
            --gray-300: #475569;
            --gray-400: #64748b;
            --gray-500: #94a3b8;
            --gray-600: #cbd5e1;
            --gray-700: #e2e8f0;
            --gray-800: #f1f5f9;
            --gray-900: #f8fafc;
            
            /* Dark Surface colors */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --surface: #1e293b;
            --surface-elevated: #334155;
            
            /* Dark Text colors */
            --text-primary: var(--gray-900);
            --text-secondary: var(--gray-600);
            --text-tertiary: var(--gray-500);
            
            /* Dark Border colors */
            --border: var(--gray-200);
            --border-light: var(--gray-300);
            
            /* Dark Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.4), 0 1px 2px -1px rgb(0 0 0 / 0.4);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.4);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.4);
            
            /* Adjust primary colors for dark mode */
            --primary-light: #4a9084;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .page-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .back-button {
            background: none;
            border: 1px solid var(--border);
            padding: 6px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
        }

        .back-button:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .workflow-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .workflow-id {
            font-family: 'Monaco', 'Menlo', monospace;
            color: var(--text-secondary);
            font-size: 12px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-dates {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .date-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .date-label {
            font-size: 9px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .date-value {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            white-space: nowrap;
        }

        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
        }

        .theme-icon {
            font-size: 14px;
            transition: transform 0.2s ease;
        }

        .theme-toggle:hover .theme-icon {
            transform: scale(1.1);
        }

        .status-badge {
            padding: 4px 8px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        .status-urgent {
            background: #fef2f2;
            color: var(--critical);
            border: 1px solid #fecaca;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 40% 60%;
            gap: 0;
        }

        /* Left Panel - Workflow Details */
        .workflow-panel {
            background: var(--surface);
            border-right: 1px solid var(--border);
            overflow-y: auto;
        }

        /* Right Panel - Task Details */
        .task-details-panel {
            background: var(--surface);
            overflow-y: auto;
        }

        .panel-header {
            padding: 8px 20px;
            border-bottom: 1px solid var(--border-light);
            background: transparent;
            font-weight: 600;
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-count {
            color: var(--text-tertiary);
            font-size: 10px;
            font-weight: 400;
            text-transform: none;
            letter-spacing: 0;
        }

        .panel-content {
            padding: 20px;
        }

        /* Property Address */
        .property-address {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            margin-bottom: 20px;
            text-align: center;
        }

        /* Workflow Details Sections */
        .detail-section {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            font-size: 13px;
            color: var(--text-primary);
            font-weight: 400;
        }

        .detail-value.monospace {
            font-family: 'Monaco', 'Menlo', monospace;
        }

        /* Progress Section */
        .progress-section {
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            padding: 16px;
            margin-bottom: 24px;
        }

        .progress-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: var(--surface);
            border: 1px solid var(--border-light);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .task-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
        }

        .task-item.active {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .task-item.pending {
            background: var(--bg-secondary);
            opacity: 0.8;
            cursor: pointer;
        }

        .task-item.pending:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
            opacity: 1;
        }

        .task-item.conditional {
            background: var(--bg-secondary);
            border-left: 3px solid var(--warning);
        }


        .task-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .task-status.completed {
            background: var(--success);
        }

        .task-status.awaiting-review {
            background: var(--critical);
        }

        .task-status.pending {
            background: var(--gray-300);
            border: 2px solid var(--gray-400);
        }

        .task-details {
            flex: 1;
            min-width: 0;
        }

        .task-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .task-meta {
            font-size: 10px;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        .task-sla {
            font-size: 9px;
            font-weight: 600;
            padding: 2px 6px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .task-sla.on-time {
            background: #f0fdf4;
            color: var(--success);
        }

        .task-sla.late {
            background: #fef2f2;
            color: var(--critical);
        }

        .task-sla.warning {
            background: #fffbeb;
            color: var(--warning);
        }

        .task-sla:not(.on-time):not(.late):not(.warning) {
            color: var(--text-tertiary);
        }

        /* Task Detail Content */
        .task-detail-content {
            padding: 0;
        }

        .task-detail-card {
            background: transparent;
            border: none;
            margin: 16px 20px;
            overflow: visible;
            box-shadow: none;
        }

        .task-detail-header {
            padding: 0 0 16px 0;
            border-bottom: 2px solid var(--primary);
            background: transparent;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .task-detail-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .task-result-status {
            font-size: 9px;
            font-weight: 600;
            padding: 3px 6px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .result-success {
            background: #f0fdf4;
            color: var(--success);
        }

        .result-failed {
            background: #fef2f2;
            color: var(--critical);
        }

        .result-review {
            background: #fffbeb;
            color: var(--warning);
        }

        .task-detail-body {
            padding: 0;
        }

        .task-detail-section {
            margin-bottom: 24px;
        }

        .task-detail-section:last-child {
            margin-bottom: 0;
        }

        .task-detail-subtitle {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 6px;
        }

        .task-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        .task-detail-item {
            font-size: 11px;
        }

        .task-detail-label {
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .task-detail-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        .task-logs {
            background: transparent;
            padding: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 10px;
            color: var(--text-secondary);
            max-height: 120px;
            overflow-y: auto;
            border-left: 3px solid var(--border);
            padding-left: 12px;
            line-height: 1.4;
        }

        .task-result-data {
            background: transparent;
            padding: 12px;
            font-size: 11px;
            color: var(--text-primary);
            border: none;
            border-left: 3px solid var(--primary);
            padding-left: 12px;
            max-height: 100px;
            overflow-y: auto;
            line-height: 1.4;
        }

        .task-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-tertiary);
        }

        .empty-state h3 {
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .empty-state p {
            font-size: 12px;
        }

        .interrupt-item {
            border: 1px solid var(--border);
            background: var(--surface);
            overflow: hidden;
        }

        .interrupt-item.critical {
            border-left: 3px solid var(--critical);
            background: linear-gradient(90deg, #fef2f2 0%, var(--surface) 100%);
        }

        .interrupt-item.standard {
            border-left: 3px solid var(--warning);
            background: linear-gradient(90deg, #fffbeb 0%, var(--surface) 100%);
        }

        .interrupt-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .interrupt-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .agent-emoji {
            font-size: 16px;
        }

        .interrupt-priority {
            font-size: 9px;
            font-weight: 600;
            padding: 3px 6px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .priority-critical {
            background: var(--critical);
            color: white;
        }

        .priority-standard {
            background: var(--warning);
            color: white;
        }

        .interrupt-content {
            padding: 16px;
        }

        .interrupt-description {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .interrupt-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .detail-small {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .detail-small .detail-label {
            font-size: 10px;
        }

        .detail-small .detail-value {
            font-size: 11px;
        }

        /* Agent Interface Previews */
        .agent-interface {
            border-top: 1px solid var(--border-light);
            background: var(--bg-secondary);
            padding: 12px 16px;
        }

        .interface-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .interface-content {
            font-size: 11px;
            color: var(--text-primary);
            line-height: 1.3;
        }

        /* Action Buttons */
        .interrupt-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn {
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            white-space: nowrap;
            gap: 4px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
        }

        /* Agent Interface Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex !important;
        }

        .modal-overlay.show {
            display: flex !important;
        }

        .agent-modal {
            background: var(--surface);
            width: 90vw;
            max-width: 1200px;
            height: 80vh;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 4px;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-content {
            flex: 1;
            overflow: hidden;
            display: flex;
        }

        /* Rex Web Interface */
        .rex-interface {
            display: flex;
            width: 100%;
        }

        .rex-sidebar {
            width: 300px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 16px;
            overflow-y: auto;
        }

        .rex-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .rex-toolbar {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .url-bar {
            flex: 1;
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: var(--surface);
            font-size: 12px;
            font-family: monospace;
        }

        .rex-browser {
            flex: 1;
            background: white;
            border: 1px solid var(--border);
            margin: 16px;
            overflow: hidden;
            position: relative;
        }

        .browser-content {
            padding: 20px;
            font-size: 13px;
            line-height: 1.4;
        }

        .form-field {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            background: var(--surface);
            font-size: 12px;
        }

        .form-button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 12px;
            cursor: pointer;
        }

        .error-message {
            background: #fef2f2;
            color: var(--critical);
            padding: 8px 12px;
            font-size: 11px;
            border: 1px solid #fecaca;
            margin-top: 8px;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .sidebar-content {
            font-size: 11px;
            color: var(--text-primary);
            line-height: 1.3;
        }

        .attempt-log {
            background: var(--bg-tertiary);
            padding: 8px;
            margin-bottom: 8px;
            font-size: 10px;
            font-family: monospace;
        }

        .credentials-box {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 12px;
            margin-bottom: 12px;
        }

        .credential-item {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-bottom: 4px;
        }

        .credential-item:last-child {
            margin-bottom: 0;
        }

        .credential-value {
            font-family: monospace;
            color: var(--text-secondary);
        }

        /* Iris Document Interface */
        .iris-interface {
            display: flex;
            width: 100%;
        }

        .iris-sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 16px;
            overflow-y: auto;
        }

        .iris-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .iris-toolbar {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .document-viewer {
            flex: 1;
            background: var(--bg-secondary);
            margin: 16px;
            border: 1px solid var(--border);
            position: relative;
            overflow: auto;
        }

        .pdf-page {
            background: white;
            margin: 20px auto;
            padding: 40px;
            box-shadow: var(--shadow);
            max-width: 600px;
            font-size: 12px;
            line-height: 1.4;
        }

        .highlight-box {
            background: rgba(255, 235, 59, 0.3);
            border: 2px solid #fbc02d;
            padding: 2px 4px;
            display: inline-block;
            position: relative;
        }

        .confidence-indicator {
            position: absolute;
            top: -20px;
            left: 0;
            background: var(--warning);
            color: white;
            font-size: 9px;
            padding: 2px 4px;
            font-weight: 600;
        }

        .ocr-results {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 12px;
            margin-bottom: 12px;
        }

        .ocr-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid var(--border-light);
            font-size: 11px;
        }

        .ocr-item:last-child {
            border-bottom: none;
        }

        .ocr-confidence {
            font-weight: 600;
            padding: 2px 6px;
            font-size: 9px;
        }

        .confidence-high {
            background: #f0fdf4;
            color: var(--success);
        }

        .confidence-low {
            background: #fef2f2;
            color: var(--critical);
        }

        .manual-override {
            background: var(--bg-tertiary);
            padding: 12px;
            margin-top: 12px;
        }

        .override-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid var(--border);
            font-size: 11px;
            margin-top: 6px;
        }

        /* Mia Email Interface */
        .mia-interface {
            display: flex;
            width: 100%;
        }

        .mia-sidebar {
            width: 350px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 16px;
            overflow-y: auto;
        }

        .mia-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .email-toolbar {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .email-viewer {
            flex: 1;
            background: var(--surface);
            margin: 16px;
            border: 1px solid var(--border);
            overflow: auto;
        }

        .email-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-secondary);
        }

        .email-meta {
            font-size: 12px;
            line-height: 1.4;
        }

        .email-from-line, .email-to-line, .email-subject-line, .email-date-line {
            margin-bottom: 4px;
        }

        .email-content {
            padding: 20px;
            font-size: 13px;
            line-height: 1.6;
        }

        .email-content p {
            margin-bottom: 12px;
        }

        .email-attachment {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 12px;
            margin: 16px 0;
        }

        .attachment-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .attachment-icon {
            font-size: 16px;
        }

        .attachment-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .attachment-size {
            color: var(--text-secondary);
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 10px;
        }

        .gmail-thread-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .gmail-thread {
            border: 1px solid var(--border-light);
            background: var(--surface);
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .gmail-thread:hover {
            border-color: var(--primary-light);
        }

        .gmail-thread.expanded {
            border-color: var(--primary);
        }

        .thread-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .thread-header:hover {
            background: var(--bg-tertiary);
        }

        .thread-info {
            flex: 1;
            min-width: 0;
        }

        .thread-subject {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .thread-meta {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 9px;
            color: var(--text-secondary);
        }

        .thread-participants {
            font-weight: 500;
        }

        .thread-count {
            color: var(--text-tertiary);
        }

        .thread-time {
            color: var(--text-tertiary);
            margin-left: auto;
        }

        .thread-toggle {
            font-size: 10px;
            color: var(--text-secondary);
            width: 12px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .gmail-thread.expanded .thread-toggle {
            transform: rotate(0deg);
        }

        .thread-emails {
            border-top: 1px solid var(--border-light);
            background: var(--bg-secondary);
        }

        .thread-email {
            padding: 6px 10px 6px 20px;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .thread-email:last-child {
            border-bottom: none;
        }

        .thread-email:hover {
            background: var(--bg-tertiary);
        }

        .thread-email.active {
            background: var(--primary-light);
            border-left: 3px solid var(--primary);
        }

        .thread-email.sent {
            border-left: 3px solid var(--success);
        }

        .thread-email.received {
            border-left: 3px solid var(--primary);
        }

        .thread-email.active.sent {
            border-left: 3px solid var(--success);
            background: #f0fdf4;
        }

        .thread-email.active.received {
            border-left: 3px solid var(--primary);
            background: var(--primary-light);
        }

        .email-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .email-sender {
            font-size: 10px;
            color: var(--text-primary);
            font-weight: 500;
            flex: 1;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .email-time {
            font-size: 9px;
            color: var(--text-tertiary);
            white-space: nowrap;
        }

        .email-status {
            font-size: 8px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .email-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .email-item {
            padding: 8px;
            background: var(--surface);
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .email-item:hover {
            background: var(--bg-tertiary);
        }

        .email-item.active {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .email-item.sent {
            border-left: 3px solid var(--success);
        }

        .email-item.received {
            border-left: 3px solid var(--primary);
        }

        .email-from {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .email-subject {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .email-time {
            font-size: 9px;
            color: var(--text-tertiary);
        }

        .email-status {
            font-size: 9px;
            color: var(--success);
            margin-top: 2px;
        }

        .template-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .template-item {
            padding: 6px 8px;
            background: var(--surface);
            border: 1px solid var(--border-light);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .template-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
        }

        /* Ria Client Communication Interface */
        .ria-interface {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .ria-sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 16px;
            overflow-y: auto;
        }

        .ria-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chat-actions {
            display: flex;
            gap: 6px;
        }

        .chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            background: var(--bg-secondary);
        }

        .message-day {
            text-align: center;
            font-size: 11px;
            color: var(--text-secondary);
            margin: 16px 0 12px 0;
            font-weight: 600;
        }

        .message {
            margin-bottom: 12px;
        }

        .message-content {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            max-width: 80%;
        }

        .message.client .message-content {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message.ria .message-content {
            margin-right: auto;
        }

        .message.system .message-content {
            margin: 0 auto;
            max-width: 60%;
            justify-content: center;
        }

        .message-icon {
            font-size: 16px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .message-text {
            background: var(--surface);
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 12px;
            line-height: 1.4;
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
        }

        .message.client .message-text {
            background: var(--primary);
            color: white;
        }

        .message.ria .message-text {
            background: var(--success);
            color: white;
        }

        .message.system .message-text {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            text-align: center;
            border: 1px solid var(--border);
        }

        .message.urgent .message-text {
            border: 2px solid var(--critical);
            background: #fef2f2;
            color: var(--critical);
        }

        .message-time {
            font-size: 9px;
            color: var(--text-tertiary);
            margin-top: 2px;
            text-align: center;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 8px 0;
            font-size: 11px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .typing-icon {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .message-input-area {
            border-top: 1px solid var(--border);
            background: var(--surface);
        }

        .ai-suggestions {
            padding: 8px 16px;
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-tertiary);
        }

        .suggestion-item {
            font-size: 11px;
            color: var(--text-secondary);
            padding: 4px 8px;
            margin: 2px 0;
            background: var(--surface);
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .suggestion-item:hover {
            background: var(--primary-light);
            color: var(--text-primary);
        }

        .message-input {
            padding: 12px 16px;
        }

        .message-input textarea {
            width: 100%;
            border: 1px solid var(--border);
            padding: 8px 12px;
            font-size: 12px;
            resize: none;
            background: var(--surface);
        }

        .input-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }

        .message-metrics {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            padding: 4px 0;
        }

        .metric-label {
            color: var(--text-secondary);
        }

        .metric-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        .metric-value.urgent {
            color: var(--critical);
            font-weight: 600;
        }

        /* Files Tab */
        .files-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .files-category {
            border: 1px solid var(--border-light);
            background: var(--surface);
        }

        .files-category-title {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-light);
        }

        .files-list {
            display: flex;
            flex-direction: column;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item:hover {
            background: var(--bg-tertiary);
        }

        .file-item.deliverable {
            background: var(--bg-secondary);
        }

        .file-icon {
            font-size: 16px;
            flex-shrink: 0;
        }

        .file-details {
            flex: 1;
            min-width: 0;
        }

        .file-name {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-meta {
            font-size: 9px;
            color: var(--text-secondary);
            line-height: 1.2;
        }

        .file-actions {
            display: flex;
            gap: 4px;
        }

        .btn-file {
            background: none;
            border: 1px solid var(--border);
            padding: 2px 4px;
            font-size: 10px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .btn-file:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-delete {
            color: var(--critical) !important;
        }

        .btn-delete:hover {
            background: #fef2f2 !important;
            border-color: var(--critical) !important;
            color: var(--critical) !important;
        }

        .file-status {
            font-size: 8px;
            font-weight: 600;
            padding: 2px 6px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            flex-shrink: 0;
        }

        .file-status.draft {
            background: #fffbeb;
            color: var(--warning);
            border: 1px solid #fbbf24;
        }

        .file-status.final {
            background: #f0fdf4;
            color: var(--success);
            border: 1px solid #22c55e;
        }

        .files-upload {
            margin-top: 12px;
        }

        .upload-area {
            border: 2px dashed var(--border);
            padding: 16px;
            text-align: center;
            background: var(--bg-secondary);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: var(--bg-tertiary);
        }

        .upload-icon {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .upload-text {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        /* File Tags */
        .file-tags {
            display: flex;
            align-items: center;
            margin-top: 4px;
        }

        .file-tag-select {
            background: var(--primary-light);
            color: var(--primary);
            border: 1px solid var(--primary);
            font-size: 9px;
            font-weight: 500;
            padding: 2px 6px;
            border-radius: 6px;
            cursor: pointer;
            outline: none;
            min-width: 100px;
        }

        .file-tag-select:focus {
            background: var(--surface);
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        .file-tag-select option {
            background: var(--surface);
            color: var(--text-primary);
            padding: 4px;
        }

        /* Nina Lender Research Interface */
        .nina-interface {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .nina-sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 16px;
            overflow-y: auto;
        }

        .nina-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .nina-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nina-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .nina-actions {
            display: flex;
            gap: 8px;
        }

        .lender-slots {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            overflow-y: auto;
        }

        .lender-slot {
            border: 1px solid var(--border);
            background: var(--surface);
            padding: 16px;
            transition: all 0.2s ease;
        }

        .lender-slot.filled {
            border-left: 4px solid var(--success);
        }

        .lender-slot.empty {
            border: 2px dashed var(--border);
            background: var(--bg-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 120px;
        }

        .lender-slot.empty:hover {
            border-color: var(--primary);
            background: var(--bg-tertiary);
        }

        .lender-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .lender-number {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .lender-status {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 8px;
            text-transform: uppercase;
        }

        .lender-status.validated {
            background: #f0fdf4;
            color: var(--success);
        }

        .lender-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .lender-loan {
            font-size: 12px;
            color: var(--text-secondary);
            font-family: monospace;
            margin-bottom: 12px;
        }

        .lender-contact {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 12px;
        }

        .contact-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
        }

        .contact-label {
            color: var(--text-secondary);
            width: 50px;
            flex-shrink: 0;
        }

        .contact-value {
            color: var(--text-primary);
            flex: 1;
            font-family: monospace;
        }

        .btn-contact {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 2px 4px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-contact:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .lender-actions {
            display: flex;
            gap: 6px;
        }

        .empty-slot-content {
            text-align: center;
        }

        .empty-icon {
            font-size: 24px;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }

        .empty-text {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .empty-subtitle {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .add-lender-form {
            background: var(--surface);
            border: 1px solid var(--border);
            margin: 20px;
            padding: 20px;
            box-shadow: var(--shadow-md);
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-light);
        }

        .form-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .form-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .form-field:last-child {
            grid-column: 1 / -1;
        }

        .form-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .research-metrics {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        /* Modal Actions */
        .modal-actions {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            background: var(--bg-tertiary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .action-group {
            display: flex;
            gap: 8px;
        }

        /* Tabs */
        .tabs-container {
            margin-top: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 16px;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab-button:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .tab-button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Audit Trail */
        .audit-trail {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .audit-item {
            padding: 12px;
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-left: 3px solid var(--primary);
        }

        .audit-timestamp {
            font-size: 10px;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .audit-event {
            font-size: 12px;
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .audit-details {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        /* Task Input/Output Form Styles - Simplified for Dark Mode */
        .task-input-form,
        .task-output-form {
            background: transparent;
            border: none;
            padding: 0;
        }

        .form-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-subsection {
            border: none;
            background: transparent;
            border-radius: 0;
            overflow: visible;
        }

        .form-subsection-title {
            background: transparent;
            padding: 0 0 8px 0;
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            border-bottom: 2px solid var(--primary);
            margin-bottom: 12px;
            letter-spacing: 0.05em;
        }

        .form-subsection-content {
            padding: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px 16px;
        }

        .form-array-item {
            border: none;
            background: transparent;
            padding: 0;
            border-radius: 0;
            margin-bottom: 12px;
            border-left: 3px solid var(--border);
            padding-left: 12px;
        }

        .form-array-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            margin-bottom: 8px;
            padding-bottom: 0;
            border-bottom: none;
            letter-spacing: 0.05em;
        }

        .form-empty {
            color: var(--text-tertiary);
            font-style: italic;
            font-size: 11px;
            text-align: center;
            padding: 20px;
        }

        .form-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .form-field .form-label {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-field .form-input {
            padding: 8px 0;
            border: none;
            border-bottom: 1px solid var(--border);
            background: transparent;
            font-size: 12px;
            color: var(--text-primary);
            border-radius: 0;
            transition: border-color 0.2s ease;
        }

        .form-field .form-input[readonly] {
            background: transparent;
            color: var(--text-primary);
            cursor: default;
            opacity: 0.8;
        }

        .form-field .form-input:focus {
            outline: none;
            border-bottom-color: var(--primary);
        }

        /* Task Data Tabs */
        .task-data-tabs {
            margin-top: 8px;
        }

        .task-tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 16px;
        }

        .task-tab-button {
            background: none;
            border: none;
            padding: 8px 16px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .task-tab-button:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .task-tab-button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .task-tab-content {
            display: none;
            animation: fadeIn 0.2s ease;
        }

        .task-tab-content.active {
            display: block;
        }

        /* Notes Tab Styles */
        .notes-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .note-compose {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 16px;
            margin-bottom: 20px;
        }

        .compose-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-light);
        }

        .compose-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .compose-actions {
            display: flex;
            gap: 8px;
        }

        .note-input {
            width: 100%;
            border: 1px solid var(--border);
            padding: 8px 12px;
            font-size: 12px;
            background: var(--surface);
            color: var(--text-primary);
            resize: vertical;
            margin-bottom: 12px;
            font-family: inherit;
        }

        .note-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        .note-meta {
            display: flex;
            gap: 16px;
            align-items: flex-start;
        }

        .tag-hils {
            flex: 1;
        }

        .meta-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 4px;
            display: block;
        }

        .hil-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 6px;
            min-height: 20px;
        }

        .tagged-hil {
            background: var(--primary-light);
            color: var(--primary);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .remove-tag {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 12px;
            cursor: pointer;
            padding: 0;
            width: 12px;
            height: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hil-selector {
            font-size: 10px;
            padding: 4px 6px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-primary);
            width: 140px;
        }

        .priority-select {
            font-size: 10px;
            padding: 4px 6px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-primary);
            width: 80px;
        }

        .notes-feed {
            flex: 1;
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .feed-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .filter-select {
            font-size: 10px;
            padding: 4px 6px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-secondary);
        }

        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .note-item {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 12px;
            transition: all 0.2s ease;
        }

        .note-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary-light);
        }

        .note-item.urgent {
            border-left: 3px solid var(--critical);
            background: linear-gradient(90deg, #fef2f2 0%, var(--surface) 100%);
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .note-author {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .author-avatar {
            font-size: 14px;
        }

        .author-name {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .author-role {
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            background: var(--bg-tertiary);
            padding: 1px 4px;
            border-radius: 2px;
        }

        .note-time {
            font-size: 9px;
            color: var(--text-tertiary);
        }

        .note-content {
            margin-bottom: 8px;
        }

        .note-priority-badge {
            font-size: 8px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase;
            margin-bottom: 6px;
            display: inline-block;
        }

        .note-priority-badge.urgent {
            background: var(--critical);
            color: white;
        }

        .note-text {
            font-size: 11px;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 6px;
        }

        .note-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .hil-mention {
            background: var(--primary-light);
            color: var(--primary);
            font-size: 9px;
            font-weight: 600;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .note-actions {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .btn-note {
            background: none;
            border: 1px solid var(--border);
            padding: 2px 6px;
            font-size: 9px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            border-radius: 3px;
        }

        .btn-note:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .interrupts-panel {
                order: -1;
            }

            .agent-modal {
                width: 95vw;
                height: 90vh;
            }

            .rex-sidebar,
            .iris-sidebar {
                width: 250px;
            }

            .note-meta {
                flex-direction: column;
                gap: 8px;
            }

            .hil-selector, .priority-select {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <button class="back-button">← Back</button>
                <div>
                    <div class="workflow-title">123 Oak Street, Miami, FL 33101</div>
                    <div class="workflow-id">PAY-0891 • Payoff Request - First National</div>
                </div>
            </div>
            <div class="header-right">
                <div class="header-dates">
                    <div class="date-item">
                        <span class="date-label">ETA:</span>
                        <span class="date-value" style="color: var(--critical);">Dec 29, 6:00 PM</span>
                    </div>
                    <div class="date-item">
                        <span class="date-label">Due:</span>
                        <span class="date-value" style="color: var(--critical);">Dec 29, 2024</span>
                    </div>
                    <div class="date-item">
                        <span class="date-label">Closing:</span>
                        <span class="date-value">Dec 30, 2024</span>
                    </div>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light mode">
                    <span class="theme-icon">🌙</span>
                </button>
                <span class="status-badge status-urgent">Urgent</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel - Workflow Details -->
            <div class="workflow-panel">
                <div class="panel-header">
                    📋 Workflow Details
                </div>
                <div class="panel-content">
                    <!-- Workflow Progress -->
                    <div class="progress-section">
                        <div class="progress-title">Task Log</div>
                        <div class="task-list">
                            <div class="task-item" onclick="selectTask('lookup-lender')" data-task="lookup-lender">
                                <div class="task-status completed"></div>
                                <div class="task-details">
                                    <div class="task-name">Lookup Lender Contact Information</div>
                                    <div class="task-meta">Start: Dec 27, 9:33 AM • End: Dec 27, 9:45 AM • 🔍 Nina</div>
                                </div>
                            </div>
                            <div class="task-item" onclick="selectTask('send-request')" data-task="send-request">
                                <div class="task-status completed"></div>
                                <div class="task-details">
                                    <div class="task-name">Send Payoff Request</div>
                                    <div class="task-meta">Start: Dec 27, 11:22 AM • End: Dec 27, 11:30 AM • 📧 Mia</div>
                                </div>
                            </div>
                            <div class="task-item" onclick="selectTask('await-response')" data-task="await-response">
                                <div class="task-status completed"></div>
                                <div class="task-details">
                                    <div class="task-name">Await Statement Response</div>
                                    <div class="task-meta">Start: Dec 27, 11:30 AM • End: Dec 29, 1:30 PM • 👤 HIL Monitor</div>
                                </div>
                            </div>
                            <div class="task-item conditional" onclick="selectTask('portal-access')" data-task="portal-access">
                                <div class="task-status awaiting-review"></div>
                                <div class="task-details">
                                    <div class="task-name">Access Lender Portal (Conditional)</div>
                                    <div class="task-meta">Start: Dec 29, 1:30 PM • End: Dec 29, 2:15 PM (Failed) • 🌐 Rex</div>
                                </div>
                            </div>
                            <div class="task-item" onclick="selectTask('process-document')" data-task="process-document">
                                <div class="task-status awaiting-review"></div>
                                <div class="task-details">
                                    <div class="task-name">Process Payoff Document</div>
                                    <div class="task-meta">Start: Dec 29, 1:30 PM • End: Dec 29, 1:45 PM (Low Confidence) • 📄 Iris</div>
                                </div>
                            </div>
                            <div class="task-item pending" onclick="selectTask('qa-review')" data-task="qa-review">
                                <div class="task-status pending"></div>
                                <div class="task-details">
                                    <div class="task-name">Quality Assurance Review</div>
                                    <div class="task-meta">Not Started • ✓ Cassy</div>
                                </div>
                            </div>
                            <div class="task-item pending" onclick="selectTask('generate-invoice')" data-task="generate-invoice">
                                <div class="task-status pending"></div>
                                <div class="task-details">
                                    <div class="task-name">Generate Invoice</div>
                                    <div class="task-meta">Not Started • 💰 Kosha</div>
                                </div>
                            </div>
                            <div class="task-item pending" onclick="selectTask('client-notification')" data-task="client-notification">
                                <div class="task-status pending"></div>
                                <div class="task-details">
                                    <div class="task-name">Client Notification</div>
                                    <div class="task-meta">Not Started • 📧 Mia</div>
                                </div>
                            </div>
                            <div class="task-item pending" onclick="selectTask('update-crm')" data-task="update-crm">
                                <div class="task-status pending"></div>
                                <div class="task-details">
                                    <div class="task-name">Update CRM Records</div>
                                    <div class="task-meta">Not Started • 🔄 System</div>
                                </div>
                            </div>
                            <div class="task-item pending" onclick="selectTask('workflow-completion')" data-task="workflow-completion">
                                <div class="task-status pending"></div>
                                <div class="task-details">
                                    <div class="task-name">Workflow Completion</div>
                                    <div class="task-meta">Not Started • 🎯 System</div>
                                </div>
                            </div>
                        </div>
                        
                    </div>

                    <!-- Tabs -->
                    <div class="tabs-container">
                        <div class="tabs">
                            <button class="tab-button active" onclick="switchTab('details')">Details</button>
                            <button class="tab-button" onclick="switchTab('files')">Files</button>
                            <button class="tab-button" onclick="switchTab('audit')">Audit Trail</button>
                            <button class="tab-button" onclick="switchTab('notes')">Notes</button>
                        </div>
                        
                        <div class="tab-content" id="details-tab">
                            <div class="detail-section">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">Borrower Name</div>
                                        <div class="detail-value">John & Maria Rodriguez</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Lender Name</div>
                                        <div class="detail-value">First National Bank</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Loan Number</div>
                                        <div class="detail-value monospace">FNB-2019-445821</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Payoff Date</div>
                                        <div class="detail-value">December 29, 2024</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Estimated Balance</div>
                                        <div class="detail-value">$247,856.32</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Primary HIL</div>
                                        <div class="detail-value">Sarah Chen</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Manager HIL</div>
                                        <div class="detail-value">Mike Johnson</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Client</div>
                                        <div class="detail-value">Sunshine Title Company</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Created</div>
                                        <div class="detail-value">Dec 27, 2024 9:15 AM</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Due Date</div>
                                        <div class="detail-value" style="color: var(--critical);">Dec 29, 2024</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">ETA</div>
                                        <div class="detail-value" style="color: var(--critical);">Dec 29, 2024</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Time Remaining</div>
                                        <div class="detail-value" style="color: var(--critical);">4 hours 15 minutes</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">SLA Status</div>
                                        <div class="detail-value" style="color: var(--critical);">CRITICAL</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="files-tab" style="display: none;">
                            <div class="files-section">
                                <div class="files-category">
                                    <div class="files-category-title">📄 Working Documents</div>
                                    <div class="files-list">
                                        <div class="file-item">
                                            <div class="file-icon">📄</div>
                                            <div class="file-details">
                                                <div class="file-name">payoff_statement_fnb.pdf</div>
                                                <div class="file-meta">2.3 MB • Dec 29, 1:30 PM • Iris</div>
                                                <div class="file-tags">
                                                    <select class="file-tag-select" onchange="updateFileTag(this)">
                                                        <option value="">Select tag...</option>
                                                        <option value="payoff-statement" selected>Payoff Statement</option>
                                                        <option value="email">Email</option>
                                                        <option value="research">Research</option>
                                                        <option value="screenshot">Screenshot</option>
                                                        <option value="contract">Contract</option>
                                                        <option value="invoice">Invoice</option>
                                                        <option value="receipt">Receipt</option>
                                                        <option value="report">Report</option>
                                                        <option value="verification">Verification</option>
                                                        <option value="correspondence">Correspondence</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="file-actions">
                                                <button class="btn-file">📁</button>
                                                <button class="btn-file">↓</button>
                                                <button class="btn-file btn-delete" onclick="deleteFile(this)">🗑️</button>
                                            </div>
                                        </div>
                                        <div class="file-item">
                                            <div class="file-icon">📧</div>
                                            <div class="file-details">
                                                <div class="file-name">payoff_request_email.msg</div>
                                                <div class="file-meta">24 KB • Dec 27, 11:27 AM • Mia</div>
                                                <div class="file-tags">
                                                    <select class="file-tag-select" onchange="updateFileTag(this)">
                                                        <option value="">Select tag...</option>
                                                        <option value="payoff-statement">Payoff Statement</option>
                                                        <option value="email" selected>Email</option>
                                                        <option value="research">Research</option>
                                                        <option value="screenshot">Screenshot</option>
                                                        <option value="contract">Contract</option>
                                                        <option value="invoice">Invoice</option>
                                                        <option value="receipt">Receipt</option>
                                                        <option value="report">Report</option>
                                                        <option value="verification">Verification</option>
                                                        <option value="correspondence">Correspondence</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="file-actions">
                                                <button class="btn-file">📁</button>
                                                <button class="btn-file">↓</button>
                                                <button class="btn-file btn-delete" onclick="deleteFile(this)">🗑️</button>
                                            </div>
                                        </div>
                                        <div class="file-item">
                                            <div class="file-icon">🔍</div>
                                            <div class="file-details">
                                                <div class="file-name">lender_research_results.json</div>
                                                <div class="file-meta">8.2 KB • Dec 27, 9:45 AM • Nina</div>
                                                <div class="file-tags">
                                                    <select class="file-tag-select" onchange="updateFileTag(this)">
                                                        <option value="">Select tag...</option>
                                                        <option value="payoff-statement">Payoff Statement</option>
                                                        <option value="email">Email</option>
                                                        <option value="research" selected>Research</option>
                                                        <option value="screenshot">Screenshot</option>
                                                        <option value="contract">Contract</option>
                                                        <option value="invoice">Invoice</option>
                                                        <option value="receipt">Receipt</option>
                                                        <option value="report">Report</option>
                                                        <option value="verification">Verification</option>
                                                        <option value="correspondence">Correspondence</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="file-actions">
                                                <button class="btn-file">📁</button>
                                                <button class="btn-file">↓</button>
                                                <button class="btn-file btn-delete" onclick="deleteFile(this)">🗑️</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="files-category">
                                    <div class="files-category-title">📦 Client Deliverables</div>
                                    <div class="files-list">
                                        <div class="file-item deliverable">
                                            <div class="file-icon">📋</div>
                                            <div class="file-details">
                                                <div class="file-name">payoff_summary_report.pdf</div>
                                                <div class="file-meta">156 KB • Draft • Pending completion</div>
                                            </div>
                                            <div class="file-status draft">DRAFT</div>
                                        </div>
                                        <div class="file-item deliverable">
                                            <div class="file-icon">💰</div>
                                            <div class="file-details">
                                                <div class="file-name">cost_breakdown.xlsx</div>
                                                <div class="file-meta">45 KB • Draft • Pending invoice generation</div>
                                            </div>
                                            <div class="file-status draft">DRAFT</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="files-category">
                                    <div class="files-category-title">💬 Message Attachments</div>
                                    <div class="files-list">
                                        <div class="file-item">
                                            <div class="file-icon">📸</div>
                                            <div class="file-details">
                                                <div class="file-name">portal_screenshot.png</div>
                                                <div class="file-meta">892 KB • Dec 29, 2:15 PM • Rex (failure)</div>
                                                <div class="file-tags">
                                                    <select class="file-tag-select" onchange="updateFileTag(this)">
                                                        <option value="">Select tag...</option>
                                                        <option value="payoff-statement">Payoff Statement</option>
                                                        <option value="email">Email</option>
                                                        <option value="research">Research</option>
                                                        <option value="screenshot" selected>Screenshot</option>
                                                        <option value="contract">Contract</option>
                                                        <option value="invoice">Invoice</option>
                                                        <option value="receipt">Receipt</option>
                                                        <option value="report">Report</option>
                                                        <option value="verification">Verification</option>
                                                        <option value="correspondence">Correspondence</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="file-actions">
                                                <button class="btn-file">📁</button>
                                                <button class="btn-file">↓</button>
                                                <button class="btn-file btn-delete" onclick="deleteFile(this)">🗑️</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="files-upload">
                                    <div class="upload-area">
                                        <div class="upload-icon">📎</div>
                                        <div class="upload-text">Drop files here or click to upload</div>
                                        <button class="btn btn-secondary btn-small">Choose Files</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="audit-tab" style="display: none;">
                            <div class="audit-trail">
                                <div class="audit-item">
                                    <div class="audit-timestamp">Dec 29, 2:15 PM</div>
                                    <div class="audit-event">🌐 Rex failed portal access - Authentication failed</div>
                                    <div class="audit-details">Stored credentials outdated, escalated to HIL</div>
                                </div>
                                <div class="audit-item">
                                    <div class="audit-timestamp">Dec 29, 1:45 PM</div>
                                    <div class="audit-event">📄 Iris completed document processing</div>
                                    <div class="audit-details">Low confidence (67%) on payoff amount, manual review required</div>
                                </div>
                                <div class="audit-item">
                                    <div class="audit-timestamp">Dec 27, 11:30 AM</div>
                                    <div class="audit-event">📧 Mia sent payoff request email</div>
                                    <div class="audit-details">Delivered to payoffs@fnb.com successfully</div>
                                </div>
                                <div class="audit-item">
                                    <div class="audit-timestamp">Dec 27, 9:45 AM</div>
                                    <div class="audit-event">🔍 Nina completed lender lookup</div>
                                    <div class="audit-details">Validated First National Bank contact information</div>
                                </div>
                                <div class="audit-item">
                                    <div class="audit-timestamp">Dec 27, 9:15 AM</div>
                                    <div class="audit-event">📋 Workflow created</div>
                                    <div class="audit-details">PAY-0891 assigned to Sarah Chen by system</div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content" id="notes-tab" style="display: none;">
                            <div class="notes-section">
                                <!-- Notes Compose Area -->
                                <div class="note-compose">
                                    <div class="compose-header">
                                        <div class="compose-title">📝 Add New Note</div>
                                        <div class="compose-actions">
                                            <button class="btn btn-secondary btn-small" onclick="clearNote()">Clear</button>
                                            <button class="btn btn-primary btn-small" onclick="saveNote()">Save Note</button>
                                        </div>
                                    </div>
                                    <div class="compose-body">
                                        <textarea class="note-input" placeholder="Add a note about this workflow..." rows="3"></textarea>
                                        <div class="note-meta">
                                            <div class="tag-hils">
                                                <label class="meta-label">Tag HILs:</label>
                                                <div class="hil-tags">
                                                    <span class="tagged-hil">@Mike Johnson <button class="remove-tag">×</button></span>
                                                </div>
                                                <select class="hil-selector" onchange="addHilTag(this)">
                                                    <option value="">Tag a HIL...</option>
                                                    <option value="sarah-chen">Sarah Chen (Primary HIL)</option>
                                                    <option value="mike-johnson">Mike Johnson (Manager)</option>
                                                    <option value="jessica-wong">Jessica Wong (HIL)</option>
                                                    <option value="david-smith">David Smith (HIL)</option>
                                                    <option value="maria-garcia">Maria Garcia (Senior HIL)</option>
                                                </select>
                                            </div>
                                            <div class="note-priority">
                                                <label class="meta-label">Priority:</label>
                                                <select class="priority-select">
                                                    <option value="normal" selected>Normal</option>
                                                    <option value="high">High</option>
                                                    <option value="urgent">Urgent</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Notes Feed -->
                                <div class="notes-feed">
                                    <div class="feed-header">
                                        <div class="feed-title">💬 Workflow Notes (3)</div>
                                        <div class="feed-filter">
                                            <select class="filter-select">
                                                <option value="all">All Notes</option>
                                                <option value="mentions">My Mentions</option>
                                                <option value="high">High Priority</option>
                                                <option value="recent">Recent (24h)</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="notes-list">
                                        <!-- Note 1 - Recent with tags -->
                                        <div class="note-item urgent">
                                            <div class="note-header">
                                                <div class="note-author">
                                                    <span class="author-avatar">👤</span>
                                                    <span class="author-name">Mike Johnson</span>
                                                    <span class="author-role">Manager</span>
                                                </div>
                                                <div class="note-time">Dec 29, 2:45 PM</div>
                                            </div>
                                            <div class="note-content">
                                                <div class="note-priority-badge urgent">🔴 URGENT</div>
                                                <div class="note-text">Rex authentication failure is blocking progress. @Sarah Chen please coordinate with client to get updated portal credentials ASAP. Closing is tomorrow and client is stressed.</div>
                                                <div class="note-tags">
                                                    <span class="hil-mention">@Sarah Chen</span>
                                                </div>
                                            </div>
                                            <div class="note-actions">
                                                <button class="btn-note">📎 Attach</button>
                                                <button class="btn-note">💬 Reply</button>
                                                <button class="btn-note">✏️ Edit</button>
                                            </div>
                                        </div>

                                        <!-- Note 2 - Progress update -->
                                        <div class="note-item">
                                            <div class="note-header">
                                                <div class="note-author">
                                                    <span class="author-avatar">👩</span>
                                                    <span class="author-name">Sarah Chen</span>
                                                    <span class="author-role">Primary HIL</span>
                                                </div>
                                                <div class="note-time">Dec 29, 1:30 PM</div>
                                            </div>
                                            <div class="note-content">
                                                <div class="note-text">Received payoff statement from First National. Iris flagged low confidence on the amount ($247,856.32). I manually verified - amount is correct, just poor scan quality. Ready for QA review.</div>
                                            </div>
                                            <div class="note-actions">
                                                <button class="btn-note">📎 Attach</button>
                                                <button class="btn-note">💬 Reply</button>
                                                <button class="btn-note">✏️ Edit</button>
                                            </div>
                                        </div>

                                        <!-- Note 3 - Initial workflow note -->
                                        <div class="note-item">
                                            <div class="note-header">
                                                <div class="note-author">
                                                    <span class="author-avatar">👤</span>
                                                    <span class="author-name">Mike Johnson</span>
                                                    <span class="author-role">Manager</span>
                                                </div>
                                                <div class="note-time">Dec 27, 9:20 AM</div>
                                            </div>
                                            <div class="note-content">
                                                <div class="note-text">High priority workflow - closing is Dec 30. Client (Sunshine Title) is a key account. @Sarah Chen assigned as primary HIL. Let's ensure smooth execution on this one.</div>
                                                <div class="note-tags">
                                                    <span class="hil-mention">@Sarah Chen</span>
                                                </div>
                                            </div>
                                            <div class="note-actions">
                                                <button class="btn-note">📎 Attach</button>
                                                <button class="btn-note">💬 Reply</button>
                                                <button class="btn-note">✏️ Edit</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Task Details -->
            <div class="task-details-panel">
                <div class="panel-header">
                    📋 Task Details
                    <span class="panel-count">Select a task to view details</span>
                </div>
                <div class="task-detail-content" id="task-detail-content">
                    <div class="empty-state">
                        <h3>No Task Selected</h3>
                        <p>Click on a task from the workflow progress to view its details, logs, and results.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rex Web Interface Modal -->
    <div class="modal-overlay" id="rex-modal">
        <div class="agent-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>🌐</span>
                    Rex Web Interface - First National Bank Portal
                </div>
                <button class="modal-close" onclick="closeModal('rex-modal')">×</button>
            </div>
            <div class="modal-content">
                <div class="rex-interface">
                    <div class="rex-sidebar">
                        <div class="sidebar-section">
                            <div class="sidebar-title">Task Context</div>
                            <div class="sidebar-content">
                                <strong>Workflow:</strong> PAY-0891<br>
                                <strong>Task:</strong> Access Lender Portal<br>
                                <strong>Objective:</strong> Login and download payoff statement<br>
                                <strong>Status:</strong> Authentication Failed
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Stored Credentials</div>
                            <div class="credentials-box">
                                <div class="credential-item">
                                    <span>Username:</span>
                                    <span class="credential-value">rexera_bot</span>
                                </div>
                                <div class="credential-item">
                                    <span>Password:</span>
                                    <span class="credential-value">***********</span>
                                </div>
                                <div class="credential-item">
                                    <span>Last Updated:</span>
                                    <span class="credential-value">Nov 15, 2024</span>
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Attempt Log</div>
                            <div class="sidebar-content">
                                <div class="attempt-log">
                                    [14:15] GET portal.fnb.com/login - 200 OK
                                </div>
                                <div class="attempt-log">
                                    [14:15] POST /authenticate - 401 Unauthorized
                                </div>
                                <div class="attempt-log">
                                    [14:17] POST /authenticate - 401 Unauthorized  
                                </div>
                                <div class="attempt-log">
                                    [14:19] POST /authenticate - 401 Unauthorized
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Alternative Methods</div>
                            <div class="sidebar-content">
                                • Phone: (800) 555-0123<br>
                                • Email: payoffs@fnb.com<br>
                                • Fax: (800) 555-0124<br>
                                • Manual portal registration
                            </div>
                        </div>
                    </div>

                    <div class="rex-main">
                        <div class="rex-toolbar">
                            <button class="btn btn-secondary">🔙 Back</button>
                            <button class="btn btn-secondary">🔄 Refresh</button>
                            <input type="text" class="url-bar" value="https://portal.fnb.com/login" readonly>
                            <button class="btn btn-secondary">🔧 Tools</button>
                        </div>
                        
                        <div class="rex-browser">
                            <div class="browser-content">
                                <h2 style="color: #0066cc; margin-bottom: 20px;">First National Bank - Payoff Portal</h2>
                                
                                <div class="form-field">
                                    <label class="form-label">Username</label>
                                    <input type="text" class="form-input" value="rexera_bot" placeholder="Enter username">
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">Password</label>
                                    <input type="password" class="form-input" value="SecurePass123!" placeholder="Enter password">
                                </div>
                                
                                <div class="form-field">
                                    <button class="form-button">Login</button>
                                </div>
                                
                                <div class="error-message">
                                    ⚠️ Error: Invalid username or password. Please check your credentials and try again.
                                </div>
                                
                                <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border: 1px solid #dee2e6;">
                                    <strong>HIL Action Required:</strong><br>
                                    The stored credentials appear to be outdated. You can:<br>
                                    • Update credentials with new login information<br>
                                    • Register a new account manually<br>
                                    • Call the bank to resolve authentication issues<br>
                                    • Use alternative communication methods
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <div class="action-group">
                    <button class="btn btn-secondary">📞 Call Bank</button>
                    <button class="btn btn-secondary">🔑 Update Credentials</button>
                    <button class="btn btn-secondary">📧 Send Email Request</button>
                </div>
                <div class="action-group">
                    <button class="btn btn-secondary" onclick="closeModal('rex-modal')">Cancel</button>
                    <button class="btn btn-primary">✅ Mark Resolved</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Iris Document Interface Modal -->
    <div class="modal-overlay" id="iris-modal">
        <div class="agent-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>📄</span>
                    Iris Document Interface - Payoff Statement Verification
                </div>
                <button class="modal-close" onclick="closeModal('iris-modal')">×</button>
            </div>
            <div class="modal-content">
                <div class="iris-interface">
                    <div class="iris-sidebar">
                        <div class="sidebar-section">
                            <div class="sidebar-title">Document Info</div>
                            <div class="sidebar-content">
                                <strong>File:</strong> payoff_statement_fnb.pdf<br>
                                <strong>Size:</strong> 2.3 MB<br>
                                <strong>Pages:</strong> 1<br>
                                <strong>Source:</strong> Email attachment<br>
                                <strong>Processed:</strong> Dec 29, 1:45 PM
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">OCR Results</div>
                            <div class="ocr-results">
                                <div class="ocr-item">
                                    <span>Borrower Name:</span>
                                    <span class="ocr-confidence confidence-high">98%</span>
                                </div>
                                <div class="ocr-item">
                                    <span>Loan Number:</span>
                                    <span class="ocr-confidence confidence-high">95%</span>
                                </div>
                                <div class="ocr-item">
                                    <span>Property Address:</span>
                                    <span class="ocr-confidence confidence-high">92%</span>
                                </div>
                                <div class="ocr-item">
                                    <span>Payoff Amount:</span>
                                    <span class="ocr-confidence confidence-low">67%</span>
                                </div>
                                <div class="ocr-item">
                                    <span>Valid Through:</span>
                                    <span class="ocr-confidence confidence-high">89%</span>
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Manual Override</div>
                            <div class="manual-override">
                                <label class="form-label">Correct Payoff Amount</label>
                                <input type="text" class="override-input" value="$247,856.32" placeholder="Enter correct amount">
                                <br><br>
                                <label class="form-label">Confidence Note</label>
                                <textarea class="override-input" rows="3" placeholder="Explain verification method...">Manually verified from source document. Amount clearly visible in payment box.</textarea>
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Extracted Data</div>
                            <div class="sidebar-content">
                                <strong>Borrower:</strong> John & Maria Rodriguez<br>
                                <strong>Loan #:</strong> FNB-2019-445821<br>
                                <strong>Property:</strong> 123 Oak Street, Miami, FL<br>
                                <strong>Amount:</strong> <span style="color: var(--critical);">$247,856.32</span><br>
                                <strong>Valid Until:</strong> Dec 31, 2024
                            </div>
                        </div>
                    </div>

                    <div class="iris-main">
                        <div class="iris-toolbar">
                            <div>
                                <button class="btn btn-secondary">🔍 Zoom In</button>
                                <button class="btn btn-secondary">🔍 Zoom Out</button>
                                <button class="btn btn-secondary">🔄 Rotate</button>
                            </div>
                            <div>
                                <span style="font-size: 12px; color: var(--text-secondary);">Page 1 of 1</span>
                            </div>
                        </div>
                        
                        <div class="document-viewer">
                            <div class="pdf-page">
                                <div style="text-align: center; margin-bottom: 20px;">
                                    <h3 style="color: #0066cc;">FIRST NATIONAL BANK</h3>
                                    <h4>MORTGAGE PAYOFF STATEMENT</h4>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <strong>Date:</strong> December 27, 2024<br>
                                    <strong>Valid Through:</strong> December 31, 2024
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <strong>Borrower(s):</strong> John Rodriguez & Maria Rodriguez<br>
                                    <strong>Property Address:</strong> 123 Oak Street, Miami, FL 33101<br>
                                    <strong>Loan Number:</strong> FNB-2019-445821
                                </div>
                                
                                <div style="border: 2px solid #0066cc; padding: 16px; margin: 20px 0; background: #f8f9fa;">
                                    <div style="margin-bottom: 12px;">
                                        <strong>Principal Balance:</strong> $245,123.45<br>
                                        <strong>Interest (thru 12/29/24):</strong> $1,456.78<br>
                                        <strong>Late Fees:</strong> $0.00<br>
                                        <strong>Other Fees:</strong> $1,276.09
                                    </div>
                                    <hr style="margin: 12px 0;">
                                    <div style="font-size: 16px; font-weight: bold;">
                                        <strong>TOTAL PAYOFF AMOUNT:</strong> 
                                        <span class="highlight-box">
                                            <span class="confidence-indicator">67%</span>
                                            $247,856.32
                                        </span>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 20px; font-size: 11px; color: #666;">
                                    This payoff amount is valid through the date specified above. Interest accrues daily.
                                    Please contact our payoff department at (800) 555-0123 for questions.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <div class="action-group">
                    <button class="btn btn-secondary">📄 Download Original</button>
                    <button class="btn btn-secondary">🔄 Re-process OCR</button>
                    <button class="btn btn-secondary">📞 Call for Verification</button>
                </div>
                <div class="action-group">
                    <button class="btn btn-secondary" onclick="closeModal('iris-modal')">Cancel</button>
                    <button class="btn btn-primary">✅ Confirm Amount</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mia Email Interface Modal -->
    <div class="modal-overlay" id="mia-modal">
        <div class="agent-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>📧</span>
                    Mia Email Interface - Payoff Request Communication
                </div>
                <button class="modal-close" onclick="closeModal('mia-modal')">×</button>
            </div>
            <div class="modal-content">
                <div class="mia-interface">
                    <div class="mia-sidebar">
                        <div class="sidebar-section">
                            <div class="sidebar-title">Email Threads</div>
                            <div class="gmail-thread-list">
                                <!-- Thread 1 - Expanded -->
                                <div class="gmail-thread expanded">
                                    <div class="thread-header" onclick="toggleThread(this)">
                                        <div class="thread-info">
                                            <div class="thread-subject">Payoff Request - PAY-0891</div>
                                            <div class="thread-meta">
                                                <span class="thread-participants">payoffs@fnb.com</span>
                                                <span class="thread-count">(2)</span>
                                                <span class="thread-time">Dec 29, 1:30 PM</span>
                                            </div>
                                        </div>
                                        <div class="thread-toggle">▼</div>
                                    </div>
                                    <div class="thread-emails">
                                        <div class="thread-email sent" onclick="selectEmail(this, 'email-1')">
                                            <div class="email-summary">
                                                <div class="email-sender">📤 To: payoffs@fnb.com</div>
                                                <div class="email-time">Dec 27, 11:27 AM</div>
                                                <div class="email-status">✓ Delivered</div>
                                            </div>
                                        </div>
                                        <div class="thread-email received active" onclick="selectEmail(this, 'email-2')">
                                            <div class="email-summary">
                                                <div class="email-sender">📥 From: payoffs@fnb.com</div>
                                                <div class="email-time">Dec 29, 1:30 PM</div>
                                                <div class="email-status">📎 Attachment</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Thread 2 - Collapsed -->
                                <div class="gmail-thread">
                                    <div class="thread-header" onclick="toggleThread(this)">
                                        <div class="thread-info">
                                            <div class="thread-subject">Urgent: Need Updated Portal Access</div>
                                            <div class="thread-meta">
                                                <span class="thread-participants">support@fnb.com</span>
                                                <span class="thread-count">(3)</span>
                                                <span class="thread-time">Dec 29, 2:10 PM</span>
                                            </div>
                                        </div>
                                        <div class="thread-toggle">▶</div>
                                    </div>
                                    <div class="thread-emails" style="display: none;">
                                        <div class="thread-email sent" onclick="selectEmail(this, 'email-3')">
                                            <div class="email-summary">
                                                <div class="email-sender">📤 To: support@fnb.com</div>
                                                <div class="email-time">Dec 29, 1:45 PM</div>
                                                <div class="email-status">✓ Delivered</div>
                                            </div>
                                        </div>
                                        <div class="thread-email received" onclick="selectEmail(this, 'email-4')">
                                            <div class="email-summary">
                                                <div class="email-sender">📥 From: support@fnb.com</div>
                                                <div class="email-time">Dec 29, 2:00 PM</div>
                                                <div class="email-status">✓ Read</div>
                                            </div>
                                        </div>
                                        <div class="thread-email sent" onclick="selectEmail(this, 'email-5')">
                                            <div class="email-summary">
                                                <div class="email-sender">📤 To: support@fnb.com</div>
                                                <div class="email-time">Dec 29, 2:10 PM</div>
                                                <div class="email-status">✓ Delivered</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Thread 3 - Single Email (Collapsed) -->
                                <div class="gmail-thread">
                                    <div class="thread-header" onclick="toggleThread(this)">
                                        <div class="thread-info">
                                            <div class="thread-subject">Payoff Status Update</div>
                                            <div class="thread-meta">
                                                <span class="thread-participants">manager@fnb.com</span>
                                                <span class="thread-count">(1)</span>
                                                <span class="thread-time">Dec 27, 3:45 PM</span>
                                            </div>
                                        </div>
                                        <div class="thread-toggle">▶</div>
                                    </div>
                                    <div class="thread-emails" style="display: none;">
                                        <div class="thread-email received" onclick="selectEmail(this, 'email-6')">
                                            <div class="email-summary">
                                                <div class="email-sender">📥 From: manager@fnb.com</div>
                                                <div class="email-time">Dec 27, 3:45 PM</div>
                                                <div class="email-status">✓ Read</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Contact Info</div>
                            <div class="sidebar-content">
                                <strong>Primary:</strong> payoffs@fnb.com<br>
                                <strong>Phone:</strong> (800) 555-0123<br>
                                <strong>Backup:</strong> loans@fnb.com<br>
                                <strong>Response Time:</strong> 24-48 hours
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Templates</div>
                            <div class="template-list">
                                <div class="template-item">Payoff Request</div>
                                <div class="template-item">Follow-up Reminder</div>
                                <div class="template-item">Urgent Request</div>
                                <div class="template-item">Document Missing</div>
                            </div>
                        </div>
                    </div>

                    <div class="mia-main">
                        <div class="email-toolbar">
                            <button class="btn btn-secondary">📧 Compose</button>
                            <button class="btn btn-secondary">↩️ Reply</button>
                            <button class="btn btn-secondary">↪️ Forward</button>
                            <button class="btn btn-secondary">📎 Attach</button>
                            <button class="btn btn-secondary">🗑️ Delete</button>
                        </div>
                        
                        <div class="email-viewer">
                            <div class="email-header">
                                <div class="email-meta">
                                    <div class="email-from-line">
                                        <strong>From:</strong> payoffs@fnb.com
                                    </div>
                                    <div class="email-to-line">
                                        <strong>To:</strong> mia@rexera.com
                                    </div>
                                    <div class="email-subject-line">
                                        <strong>Subject:</strong> Re: Payoff Request - PAY-0891 - Rodriguez Property
                                    </div>
                                    <div class="email-date-line">
                                        <strong>Date:</strong> December 29, 2024 1:30 PM
                                    </div>
                                </div>
                            </div>
                            
                            <div class="email-content">
                                <p>Dear Rexera Team,</p>
                                
                                <p>Thank you for your payoff request for loan FNB-2019-445821.</p>
                                
                                <p>Please find the attached payoff statement for the property at 123 Oak Street, Miami, FL 33101. The payoff amount is valid through December 31, 2024.</p>
                                
                                <p><strong>Important:</strong> Please note that interest accrues daily, so the final amount may vary if the payoff is processed after the valid date.</p>
                                
                                <div class="email-attachment">
                                    <div class="attachment-item">
                                        <span class="attachment-icon">📄</span>
                                        <span class="attachment-name">payoff_statement_fnb.pdf</span>
                                        <span class="attachment-size">(2.3 MB)</span>
                                        <button class="btn btn-secondary btn-small">Download</button>
                                    </div>
                                </div>
                                
                                <p>If you have any questions, please contact our payoff department at (800) 555-0123.</p>
                                
                                <p>Best regards,<br>
                                First National Bank<br>
                                Payoff Department</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <div class="action-group">
                    <button class="btn btn-secondary">📧 Send Follow-up</button>
                    <button class="btn btn-secondary">📞 Call Bank</button>
                    <button class="btn btn-secondary">📎 Download Attachment</button>
                </div>
                <div class="action-group">
                    <button class="btn btn-secondary" onclick="closeModal('mia-modal')">Cancel</button>
                    <button class="btn btn-primary">✅ Mark Complete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ria Client Communication Interface Modal -->
    <div class="modal-overlay" id="ria-modal">
        <div class="agent-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>👩‍💼</span>
                    Ria Client Communication - PAY-0891
                </div>
                <button class="modal-close" onclick="closeModal('ria-modal')">×</button>
            </div>
            <div class="modal-content">
                <div class="ria-interface">
                    <div class="ria-sidebar">
                        <div class="sidebar-section">
                            <div class="sidebar-title">Client Info</div>
                            <div class="sidebar-content">
                                <strong>Client:</strong> Sunshine Title Company<br>
                                <strong>Contact:</strong> Jennifer Martinez<br>
                                <strong>Email:</strong> j.martinez@suntitle.com<br>
                                <strong>Phone:</strong> (305) 555-0199<br>
                                <strong>Preference:</strong> Email + SMS
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Message Status</div>
                            <div class="message-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Total Messages:</span>
                                    <span class="metric-value">6</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Response Time:</span>
                                    <span class="metric-value">2 min avg</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Sentiment:</span>
                                    <span class="metric-value urgent">😟 Concerned</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Priority:</span>
                                    <span class="metric-value urgent">🔴 High</span>
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Quick Templates</div>
                            <div class="template-list">
                                <div class="template-item">Status Update</div>
                                <div class="template-item">Delay Notification</div>
                                <div class="template-item">Document Request</div>
                                <div class="template-item">Completion Notice</div>
                                <div class="template-item">Escalation</div>
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Workflow Context</div>
                            <div class="sidebar-content">
                                <strong>Status:</strong> Portal access failed<br>
                                <strong>Due:</strong> Dec 29 (Today!)<br>
                                <strong>Blocking:</strong> Rex authentication<br>
                                <strong>ETA:</strong> End of day
                            </div>
                        </div>
                    </div>

                    <div class="ria-main">
                        <div class="chat-header">
                            <div class="chat-title">💬 Conversation Thread</div>
                            <div class="chat-actions">
                                <button class="btn btn-secondary btn-small">📞 Call</button>
                                <button class="btn btn-secondary btn-small">📧 Email</button>
                                <button class="btn btn-secondary btn-small">💡 AI Suggest</button>
                            </div>
                        </div>
                        
                        <div class="chat-messages">
                            <div class="message-day">December 27, 2024</div>
                            
                            <div class="message system">
                                <div class="message-content">
                                    <span class="message-icon">🤖</span>
                                    <div class="message-text">Workflow PAY-0891 started. Estimated completion: Dec 29, 2024</div>
                                    <div class="message-time">9:30 AM</div>
                                </div>
                            </div>

                            <div class="message client">
                                <div class="message-content">
                                    <span class="message-icon">👤</span>
                                    <div class="message-text">Hi! When will this payoff request be completed? I have a closing scheduled for Dec 30.</div>
                                    <div class="message-time">11:45 AM</div>
                                </div>
                            </div>

                            <div class="message ria">
                                <div class="message-content">
                                    <span class="message-icon">👩‍💼</span>
                                    <div class="message-text">Hello Jennifer! We're on track to complete this by Dec 29, 2024. I'll send updates as we progress. Your closing should be fine!</div>
                                    <div class="message-time">11:47 AM</div>
                                </div>
                            </div>

                            <div class="message-day">December 29, 2024</div>

                            <div class="message system">
                                <div class="message-content">
                                    <span class="message-icon">⚠️</span>
                                    <div class="message-text">Status update: Processing delays due to lender portal authentication issues. Working to resolve.</div>
                                    <div class="message-time">10:15 AM</div>
                                </div>
                            </div>

                            <div class="message client urgent">
                                <div class="message-content">
                                    <span class="message-icon">😰</span>
                                    <div class="message-text">This is urgent! I need this completed today or my closing will be delayed. Can someone please call me?</div>
                                    <div class="message-time">1:50 PM</div>
                                </div>
                            </div>

                            <div class="message ria">
                                <div class="message-content">
                                    <span class="message-icon">👩‍💼</span>
                                    <div class="message-text">Jennifer, I understand the urgency. I've escalated this to our senior team and we're working on it right now. I'll call you within 15 minutes with an update. We're committed to completing this today.</div>
                                    <div class="message-time">1:52 PM</div>
                                </div>
                            </div>

                            <div class="typing-indicator">
                                <span class="typing-icon">💭</span>
                                <span class="typing-text">Ria is typing...</span>
                            </div>
                        </div>

                        <div class="message-input-area">
                            <div class="ai-suggestions">
                                <div class="suggestion-item">💡 "I'm monitoring this personally and will update you within the hour"</div>
                                <div class="suggestion-item">💡 "Let me call you right now to discuss the timeline"</div>
                                <div class="suggestion-item">💡 "We have a backup plan in place if needed"</div>
                            </div>
                            <div class="message-input">
                                <textarea placeholder="Type your message..." rows="3"></textarea>
                                <div class="input-actions">
                                    <button class="btn btn-secondary btn-small">📎 Attach</button>
                                    <button class="btn btn-secondary btn-small">😊 Emoji</button>
                                    <button class="btn btn-primary">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <div class="action-group">
                    <button class="btn btn-secondary">📞 Call Client</button>
                    <button class="btn btn-secondary">📧 Send Email Update</button>
                    <button class="btn btn-secondary">⚠️ Escalate to Manager</button>
                </div>
                <div class="action-group">
                    <button class="btn btn-secondary" onclick="closeModal('ria-modal')">Cancel</button>
                    <button class="btn btn-primary">✅ Mark Resolved</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Nina Lender Research Interface Modal -->
    <div class="modal-overlay" id="nina-modal">
        <div class="agent-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>🔍</span>
                    Nina Lender Research - PAY-0891
                </div>
                <button class="modal-close" onclick="closeModal('nina-modal')">×</button>
            </div>
            <div class="modal-content">
                <div class="nina-interface">
                    <div class="nina-sidebar">
                        <div class="sidebar-section">
                            <div class="sidebar-title">Current Workflow</div>
                            <div class="sidebar-content">
                                <strong>Type:</strong> Payoff Request<br>
                                <strong>Property:</strong> 123 Oak Street<br>
                                <strong>Borrower:</strong> Rodriguez<br>
                                <strong>Status:</strong> Researching lenders
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Research Progress</div>
                            <div class="research-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Lenders Found:</span>
                                    <span class="metric-value">1 of 3</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Validated:</span>
                                    <span class="metric-value">100%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Confidence:</span>
                                    <span class="metric-value">High</span>
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Research Sources</div>
                            <div class="sidebar-content">
                                • County Records Database<br>
                                • MLS Listing History<br>
                                • Public Filing Search<br>
                                • Credit Bureau Records<br>
                                • Lender Portal Verification
                            </div>
                        </div>

                        <div class="sidebar-section">
                            <div class="sidebar-title">Quick Actions</div>
                            <div class="template-list">
                                <div class="template-item">Search by Loan Number</div>
                                <div class="template-item">Property History Lookup</div>
                                <div class="template-item">Borrower Name Search</div>
                                <div class="template-item">Manual Entry</div>
                            </div>
                        </div>
                    </div>

                    <div class="nina-main">
                        <div class="nina-header">
                            <div class="nina-title">🏦 Lender Management</div>
                            <div class="nina-actions">
                                <button class="btn btn-secondary btn-small">🔍 Auto Search</button>
                                <button class="btn btn-secondary btn-small">📋 Import CSV</button>
                                <button class="btn btn-primary btn-small">➕ Add Lender</button>
                            </div>
                        </div>
                        
                        <div class="lender-slots">
                            <!-- Lender Slot 1 - Filled -->
                            <div class="lender-slot filled">
                                <div class="lender-header">
                                    <div class="lender-number">Lender 1</div>
                                    <div class="lender-status validated">✓ Validated</div>
                                </div>
                                <div class="lender-details">
                                    <div class="lender-name">First National Bank</div>
                                    <div class="lender-loan">Loan #: FNB-2019-445821</div>
                                    <div class="lender-contact">
                                        <div class="contact-row">
                                            <span class="contact-label">Phone:</span>
                                            <span class="contact-value">(800) 555-0123</span>
                                            <button class="btn-contact">📞</button>
                                        </div>
                                        <div class="contact-row">
                                            <span class="contact-label">Email:</span>
                                            <span class="contact-value">payoffs@fnb.com</span>
                                            <button class="btn-contact">📧</button>
                                        </div>
                                        <div class="contact-row">
                                            <span class="contact-label">Portal:</span>
                                            <span class="contact-value">portal.fnb.com</span>
                                            <button class="btn-contact">🌐</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="lender-actions">
                                    <button class="btn btn-secondary btn-small">✏️ Edit</button>
                                    <button class="btn btn-secondary btn-small">🗑️ Remove</button>
                                </div>
                            </div>

                            <!-- Lender Slot 2 - Empty -->
                            <div class="lender-slot empty" onclick="addLender(2)">
                                <div class="empty-slot-content">
                                    <div class="empty-icon">➕</div>
                                    <div class="empty-text">Add Secondary Lender</div>
                                    <div class="empty-subtitle">Click to search or add manually</div>
                                </div>
                            </div>

                            <!-- Lender Slot 3 - Empty -->
                            <div class="lender-slot empty" onclick="addLender(3)">
                                <div class="empty-slot-content">
                                    <div class="empty-icon">➕</div>
                                    <div class="empty-text">Add Third Lender</div>
                                    <div class="empty-subtitle">Optional additional lender</div>
                                </div>
                            </div>
                        </div>

                        <!-- Add Lender Form (Hidden by default) -->
                        <div class="add-lender-form" id="add-lender-form" style="display: none;">
                            <div class="form-header">
                                <h3>Add New Lender</h3>
                                <button class="btn btn-secondary btn-small" onclick="hideAddForm()">Cancel</button>
                            </div>
                            <div class="form-grid">
                                <div class="form-field">
                                    <label class="form-label">Lender Name</label>
                                    <input type="text" class="form-input" placeholder="e.g., Wells Fargo Bank">
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Loan Number</label>
                                    <input type="text" class="form-input" placeholder="e.g., WF-2020-123456">
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Phone Number</label>
                                    <input type="text" class="form-input" placeholder="(800) 555-0000">
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Email Address</label>
                                    <input type="email" class="form-input" placeholder="payoffs@bank.com">
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Website/Portal</label>
                                    <input type="url" class="form-input" placeholder="https://portal.bank.com">
                                </div>
                                <div class="form-field">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-input" rows="2" placeholder="Additional notes or special instructions"></textarea>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-secondary">🔍 Auto-Validate</button>
                                <button class="btn btn-primary">✅ Add Lender</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <div class="action-group">
                    <button class="btn btn-secondary">🔍 Research More</button>
                    <button class="btn btn-secondary">📄 Export List</button>
                    <button class="btn btn-secondary">🔄 Validate All</button>
                </div>
                <div class="action-group">
                    <button class="btn btn-secondary" onclick="closeModal('nina-modal')">Cancel</button>
                    <button class="btn btn-primary">✅ Save & Continue</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Task data for populating the detail panel
        const taskData = {
            'lookup-lender': {
                name: 'Lookup Lender Contact Information',
                agent: '🔍 Nina',
                status: 'COMPLETED',
                completed_at: 'Dec 27, 9:45 AM',
                sla_status: 'ON TIME',
                duration: '12 minutes',
                assigned_to: 'Nina (Data Detective)',
                description: 'Research and validate First National Bank contact information for payoff request submission.',
                input_data: {
                    workflowId: 'PAY-0891',
                    borrowerInfo: {
                        name: 'John & Maria Rodriguez',
                        propertyAddress: '123 Oak Street, Miami, FL 33101'
                    },
                    loanInfo: {
                        loanNumber: 'FNB-2019-445821',
                        lenderName: 'First National Bank'
                    },
                    searchCriteria: {
                        validateContact: true,
                        checkPortalAccess: true,
                        verifyPayoffDepartment: true
                    }
                },
                output_data: {
                    lenderContact: {
                        name: 'First National Bank',
                        phone: '(800) 555-0123',
                        email: 'payoffs@fnb.com',
                        portalUrl: 'portal.fnb.com',
                        department: 'Payoff Department'
                    },
                    validation: {
                        phoneVerified: true,
                        emailVerified: true,
                        portalAccessible: true,
                        businessHours: '8 AM - 6 PM EST',
                        avgResponseTime: '24-48 hours'
                    },
                    confidence: 'HIGH'
                },
                logs: `[09:33] Starting lender lookup for FNB-2019-445821
[09:34] Searching counterparty database for "First National Bank"
[09:36] Found existing counterparty record (ID: 1247)
[09:37] Validating contact information with public records
[09:42] Phone verification: (800) 555-0123 - Active
[09:44] Email verification: payoffs@fnb.com - Valid
[09:45] Task completed successfully`,
                result: {
                    status: 'SUCCESS',
                    data: 'Validated contact information for First National Bank. Phone: (800) 555-0123, Email: payoffs@fnb.com, Portal: portal.fnb.com'
                },
                can_open_agent: true,
                agent_modal: 'nina'
            },
            'send-request': {
                name: 'Send Payoff Request',
                agent: '📧 Mia',
                status: 'COMPLETED',
                completed_at: 'Dec 27, 11:30 AM',
                sla_status: 'ON TIME',
                duration: '8 minutes',
                assigned_to: 'Mia (Email Agent) - Auto-selected method',
                description: 'Send formal payoff request to First National Bank. Agent selection: Email method chosen based on lender communication preferences.',
                input_data: {
                    lenderContact: {
                        email: 'payoffs@fnb.com',
                        name: 'First National Bank',
                        preferredMethod: 'EMAIL'
                    },
                    payoffRequest: {
                        borrowerName: 'John & Maria Rodriguez',
                        propertyAddress: '123 Oak Street, Miami, FL 33101',
                        loanNumber: 'FNB-2019-445821',
                        requestedPayoffDate: '2024-12-29',
                        closingDate: '2024-12-30'
                    },
                    emailTemplate: 'PAYOFF_REQUEST_TEMPLATE',
                    urgencyLevel: 'HIGH'
                },
                output_data: {
                    emailDetails: {
                        messageId: 'MSG-2024-12-27-1127',
                        subject: 'Payoff Request - Rodriguez Property (FNB-2019-445821)',
                        sentTo: 'payoffs@fnb.com',
                        sentAt: '2024-12-27T11:27:00Z',
                        deliveryStatus: 'DELIVERED'
                    },
                    requestDetails: {
                        payoffDate: '2024-12-29',
                        documentsRequested: ['payoff_statement', 'per_diem_rate'],
                        responseDeadline: '2024-12-29T17:00:00Z'
                    },
                    trackingInfo: {
                        emailOpened: true,
                        responseExpected: '24-48 hours'
                    }
                },
                logs: `[11:22] Analyzing lender communication preferences
[11:23] Selected method: EMAIL (no IVR system detected)
[11:24] Composing payoff request email
[11:25] Retrieving borrower information from workflow
[11:26] Generating email from template: PAYOFF_REQUEST_TEMPLATE
[11:27] Email sent to: payoffs@fnb.com
[11:28] Delivery confirmation received
[11:30] Task completed successfully`,
                result: {
                    status: 'SUCCESS',
                    data: 'Payoff request email sent successfully via Mia (Email method). Message ID: MSG-2024-12-27-1127. Requested payoff date: December 29, 2024.'
                },
                can_open_agent: true,
                agent_modal: 'mia'
            },
            'await-response': {
                name: 'Await Statement Response',
                agent: '👤 HIL Monitor',
                status: 'COMPLETED',
                completed_at: 'Dec 29, 1:30 PM',
                sla_status: 'ON TIME',
                duration: '2 days 2 hours (within 7-day limit)',
                assigned_to: 'HIL Monitoring System',
                description: 'Monitor for payoff statement response from lender within 7-day timeout period. Manual oversight for email responses and document uploads.',
                logs: `[Dec 27, 11:30 AM] Monitoring started - 7-day timeout set
[Dec 28, 10:00 AM] Daily check - no response yet
[Dec 29, 1:30 PM] Email received from payoffs@fnb.com
[Dec 29, 1:31 PM] Attachment detected: payoff_statement_fnb.pdf
[Dec 29, 1:32 PM] Response confirmed within SLA
[Dec 29, 1:32 PM] Task completed - triggering document processing`,
                result: {
                    status: 'SUCCESS',
                    data: 'Payoff statement received within 7-day SLA. Email from payoffs@fnb.com with PDF attachment (2.3 MB). Ready for document processing.'
                },
                can_open_agent: false
            },
            'portal-access': {
                name: 'Access Lender Portal',
                agent: '🌐 Rex',
                status: 'AWAITING_REVIEW',
                completed_at: 'Dec 29, 2:15 PM',
                sla_status: 'LATE',
                duration: '45 minutes (failed)',
                assigned_to: 'Rex (Web Agent)',
                description: 'Access First National Bank online portal to download official payoff statement.',
                input_data: {
                    portalAccess: {
                        portalUrl: 'portal.fnb.com/login',
                        username: 'rexera_bot',
                        lastCredentialUpdate: '2024-11-15',
                        maxRetryAttempts: 3
                    },
                    taskObjective: {
                        targetDocument: 'payoff_statement',
                        loanNumber: 'FNB-2019-445821',
                        downloadFormat: 'PDF',
                        backupMethods: ['phone', 'email', 'fax']
                    },
                    securitySettings: {
                        userAgent: 'Rexera Bot v2.1',
                        timeout: 30000,
                        screenshotOnError: true
                    }
                },
                output_data: {
                    attemptResults: {
                        totalAttempts: 3,
                        authenticationStatus: 'FAILED',
                        errorType: 'INVALID_CREDENTIALS',
                        lastAttemptAt: '2024-12-29T14:19:00Z'
                    },
                    diagnostics: {
                        portalAccessible: true,
                        loginPageLoaded: true,
                        credentialsOutdated: true,
                        errorScreenshots: ['portal_auth_error_1.png', 'portal_auth_error_2.png']
                    },
                    escalationInfo: {
                        hilNotified: true,
                        alternativeMethods: ['Call (800) 555-0123', 'Email payoffs@fnb.com', 'Manual portal registration'],
                        blockingWorkflow: true
                    }
                },
                logs: `[14:15] Navigating to portal.fnb.com/login
[14:15] Loading stored credentials for FNB portal
[14:16] Attempting login with username: rexera_bot
[14:16] Authentication failed - Invalid credentials
[14:17] Retry attempt #1
[14:17] Authentication failed - Invalid credentials
[14:19] Retry attempt #2
[14:19] Authentication failed - Invalid credentials
[14:21] Maximum retry attempts reached
[14:21] Escalating to HIL for manual intervention`,
                result: {
                    status: 'FAILED',
                    data: 'Portal authentication failed after 3 attempts. Stored credentials appear to be outdated. Manual intervention required.'
                },
                can_open_agent: true,
                agent_modal: 'rex'
            },
            'process-document': {
                name: 'Process Payoff Document',
                agent: '📄 Iris',
                status: 'AWAITING_REVIEW',
                completed_at: 'Dec 29, 1:45 PM',
                sla_status: 'DUE SOON',
                duration: '15 minutes',
                assigned_to: 'Iris (Document Agent)',
                description: 'Process received payoff statement document and extract key financial information.',
                input_data: {
                    documentInfo: {
                        filename: 'payoff_statement_fnb.pdf',
                        fileSize: '2.3 MB',
                        pageCount: 1,
                        receivedFrom: 'payoffs@fnb.com',
                        receivedAt: '2024-12-29T13:30:00Z'
                    },
                    extractionTargets: {
                        borrowerName: true,
                        loanNumber: true,
                        propertyAddress: true,
                        payoffAmount: true,
                        validThrough: true,
                        perDiemRate: true
                    },
                    processingSettings: {
                        ocrEngine: 'advanced',
                        confidenceThreshold: 85,
                        manualReviewIfBelow: 70
                    }
                },
                output_data: {
                    extractedData: {
                        borrowerName: 'John Rodriguez & Maria Rodriguez',
                        loanNumber: 'FNB-2019-445821',
                        propertyAddress: '123 Oak Street, Miami, FL 33101',
                        payoffAmount: '$247,856.32',
                        validThrough: '2024-12-31',
                        perDiemRate: '$54.23'
                    },
                    confidenceScores: {
                        borrowerName: 98,
                        loanNumber: 95,
                        propertyAddress: 92,
                        payoffAmount: 67,
                        validThrough: 89,
                        perDiemRate: 78
                    },
                    reviewFlags: {
                        lowConfidenceFields: ['payoffAmount'],
                        manualReviewRequired: true,
                        reasonsForReview: ['Poor scan quality on amount field']
                    }
                },
                logs: `[13:30] Received payoff statement via email
[13:31] Starting OCR processing on payoff_statement_fnb.pdf
[13:33] OCR completed - Processing 1 page document
[13:35] Extracting borrower information - 98% confidence
[13:36] Extracting loan number - 95% confidence
[13:38] Extracting property address - 92% confidence
[13:40] Extracting payoff amount - 67% confidence (LOW)
[13:42] Manual review required for payoff amount
[13:45] Document processing completed with manual review flag`,
                result: {
                    status: 'REVIEW_REQUIRED',
                    data: 'Document processed successfully. Low confidence (67%) on payoff amount extraction: $247,856.32. Manual verification recommended.'
                },
                can_open_agent: true,
                agent_modal: 'iris'
            },
            'qa-review': {
                name: 'Quality Assurance Review',
                agent: '✓ Cassy',
                status: 'PENDING',
                completed_at: 'Not started',
                sla_status: 'PENDING',
                duration: 'N/A',
                assigned_to: 'Cassy (QA Agent)',
                description: 'Comprehensive quality assurance review of all workflow outputs to ensure accuracy and completeness before client delivery.',
                logs: `Task is waiting for dependencies to complete:
- Portal Access (Rex) - FAILED - Requires HIL intervention
- Process Payoff Document (Iris) - AWAITING REVIEW - Low confidence extraction

This task will automatically start once the blocking tasks are resolved.`,
                result: {
                    status: 'PENDING',
                    data: 'Task has not started. Waiting for Portal Access and Document Processing tasks to complete successfully.'
                },
                dependencies: ['portal-access', 'process-document']
            },
            'generate-invoice': {
                name: 'Generate Invoice',
                agent: '💰 Kosha',
                status: 'PENDING',
                completed_at: 'Not started',
                sla_status: 'PENDING',
                duration: 'N/A',
                assigned_to: 'Kosha (Finance Agent)',
                description: 'Generate client invoice based on completed workflow costs and billable items from the payoff request process.',
                logs: `Task is waiting for dependencies to complete:
- Quality Assurance Review (Cassy) - PENDING - Blocked by other tasks

This task will automatically start once QA review is completed.`,
                result: {
                    status: 'PENDING',
                    data: 'Task has not started. Waiting for Quality Assurance Review to complete successfully.'
                },
                dependencies: ['qa-review']
            },
            'update-crm': {
                name: 'Update CRM Records',
                agent: '🔄 Auto',
                status: 'PENDING',
                completed_at: 'Not started',
                sla_status: 'PENDING',
                duration: 'N/A',
                assigned_to: 'Automated System',
                description: 'Automatically update CRM system with completed workflow information, final costs, and client deliverables.',
                logs: `Task is waiting for dependencies to complete:
- Generate Invoice (Kosha) - PENDING - Blocked by other tasks

This task will automatically start once invoice generation is completed.`,
                result: {
                    status: 'PENDING',
                    data: 'Task has not started. Waiting for Invoice Generation to complete successfully.'
                },
                dependencies: ['generate-invoice']
            },
            'client-communication': {
                name: 'Client Communication',
                agent: '👩‍💼 Ria',
                status: 'COMPLETED',
                completed_at: 'Ongoing',
                sla_status: 'ACTIVE',
                duration: 'Dynamic/Parallel',
                assigned_to: 'Ria (Support Agent)',
                description: 'Dynamic parallel task handling client communication throughout workflow. Responds to client inquiries and provides proactive status updates.',
                input_data: {
                    clientInfo: {
                        company: 'Sunshine Title Company',
                        contactName: 'Jennifer Martinez',
                        email: 'j.martinez@suntitle.com',
                        phone: '(305) 555-0199',
                        preferredChannels: ['email', 'sms']
                    },
                    workflowContext: {
                        workflowId: 'PAY-0891',
                        urgencyLevel: 'HIGH',
                        closingDate: '2024-12-30',
                        keyMilestones: ['request_sent', 'response_received', 'documents_processed', 'completed']
                    },
                    communicationSettings: {
                        proactiveUpdates: true,
                        updateFrequency: 'daily',
                        escalationThreshold: 'urgent_inquiry',
                        responseTimeTarget: '15 minutes'
                    }
                },
                output_data: {
                    messagingStats: {
                        totalMessages: 6,
                        clientMessages: 3,
                        riaResponses: 3,
                        avgResponseTime: '2 minutes',
                        lastActivity: '2024-12-29T13:52:00Z'
                    },
                    sentimentAnalysis: {
                        currentSentiment: 'CONCERNED',
                        sentimentTrend: 'DECLINING',
                        urgencyIndicators: ['closing tomorrow', 'ASAP', 'need this'],
                        escalationRequired: true
                    },
                    actionsTaken: {
                        proactiveUpdates: 2,
                        escalationsToHIL: 1,
                        urgentResponsesProvided: 1,
                        timelineCommitments: ['completion by end of day']
                    }
                },
                logs: `[Dec 27, 9:30 AM] Initial workflow notification sent to client
[Dec 27, 11:45 AM] Client inquiry: "When will this be completed?"
[Dec 27, 11:47 AM] Ria responded: "We expect completion by Dec 29, 2024"
[Dec 29, 10:15 AM] Automatic status update sent: "Processing delays due to lender portal issues"
[Dec 29, 1:50 PM] Client message: "Need this ASAP for closing tomorrow"
[Dec 29, 1:52 PM] Ria escalated to HIL and provided realistic timeline`,
                result: {
                    status: 'ONGOING',
                    data: '3 messages handled dynamically. Latest: Client urgency escalated to HIL. Maintaining proactive communication.'
                },
                can_open_agent: true,
                agent_modal: 'ria'
            },
            'client-notification': {
                name: 'Client Notification',
                agent: '📧 Mia',
                status: 'PENDING',
                completed_at: 'Not started',
                sla_status: 'PENDING',
                duration: 'N/A',
                assigned_to: 'Mia (Email Agent)',
                description: 'Send final notification to client with completed payoff details, statement PDF, and invoice.',
                logs: `Task is waiting for dependencies to complete:
- Generate Invoice (Kosha) - PENDING

This task will automatically start once invoice generation is completed.`,
                result: {
                    status: 'PENDING',
                    data: 'Task has not started. Waiting for Invoice Generation to complete successfully.'
                },
                dependencies: ['generate-invoice']
            },
            'workflow-completion': {
                name: 'Workflow Completion',
                agent: '🎯 System',
                status: 'PENDING',
                completed_at: 'Not started',
                sla_status: 'PENDING',
                duration: 'N/A',
                assigned_to: 'Automated System',
                description: 'Final system task to close workflow, create output records, and mark all deliverables complete.',
                logs: `Task is waiting for dependencies to complete:
- Update CRM Records (System) - PENDING

This task will automatically start once CRM update is completed.`,
                result: {
                    status: 'PENDING',
                    data: 'Task has not started. Waiting for CRM Update to complete successfully.'
                },
                dependencies: ['update-crm']
            },
            'hoa-email-response': {
                name: 'URGENT: HOA Email Response Required',
                agent: '📧 Mia',
                status: 'PROCESSING',
                completed_at: 'In Progress',
                sla_status: 'PROCESSING',
                duration: 'Real-time',
                assigned_to: 'Mia (Email Agent) - Dynamic trigger',
                description: 'Dynamic task triggered by incoming HOA email requiring immediate attention and response.',
                logs: `[14:45] Email received from hoa@pinemeadows.com
[14:45] Subject: "Updated HOA documents attached for 123 Oak Street"
[14:46] Auto-triggered Mia for email analysis
[14:46] Analyzing email content and attachments
[14:47] Determining response requirements...`,
                result: {
                    status: 'PROCESSING',
                    data: 'Email analysis in progress. Determining appropriate response to HOA document update.'
                },
                can_open_agent: true,
                agent_modal: 'mia'
            },
            'document-upload': {
                name: 'Document Upload Detected',
                agent: '📄 Iris',
                status: 'PROCESSING',
                completed_at: 'In Progress',
                sla_status: 'OCR RUNNING',
                duration: 'Real-time',
                assigned_to: 'Iris (Document Agent) - Dynamic trigger',
                description: 'Dynamic task triggered by document upload detection requiring OCR processing.',
                logs: `[14:30] Document upload detected: updated_payoff_statement.pdf
[14:30] File size: 2.8 MB, Format: PDF
[14:31] Auto-triggered Iris for OCR processing
[14:31] Starting advanced OCR analysis
[14:32] Processing document structure...`,
                result: {
                    status: 'PROCESSING',
                    data: 'OCR processing in progress for uploaded payoff statement document.'
                },
                can_open_agent: true,
                agent_modal: 'iris'
            },
            'portal-auth-failure': {
                name: 'URGENT: Lender Portal Authentication Failed',
                agent: '🌐 Rex → Florian',
                status: 'ESCALATING',
                completed_at: 'In Progress',
                sla_status: 'ESCALATING',
                duration: 'Real-time',
                assigned_to: 'Rex (Web Agent) → Florian (Human Specialist)',
                description: 'Dynamic task triggered by portal authentication failure requiring human intervention.',
                logs: `[14:15] Portal authentication failed for Rex
[14:15] Auto-triggered escalation workflow
[14:16] Assigning to Florian for manual intervention
[14:16] Preparing credential update procedures
[14:17] Escalation in progress...`,
                result: {
                    status: 'ESCALATING',
                    data: 'Authentication failure escalated to human specialist for credential update.'
                },
                can_open_agent: true,
                agent_modal: 'rex'
            },
            'webhook-update': {
                name: 'Webhook: Title Company Status Update',
                agent: '📡 Kosha',
                status: 'PROCESSING',
                completed_at: 'In Progress',
                sla_status: 'PARSING',
                duration: 'Real-time',
                assigned_to: 'Kosha (Integration Agent) - Dynamic trigger',
                description: 'Dynamic task triggered by webhook from title company with status update.',
                logs: `[14:20] Webhook received from Sunshine Title API
[14:20] Payload: Closing date change notification
[14:21] Auto-triggered Kosha for webhook processing
[14:21] Parsing webhook data structure
[14:22] Validating closing date change...`,
                result: {
                    status: 'PROCESSING',
                    data: 'Processing webhook notification about closing date change to January 3rd, 2025.'
                }
            },
            'quality-check': {
                name: 'Automated Quality Check',
                agent: '🔍 Cassy',
                status: 'RUNNING',
                completed_at: 'In Progress',
                sla_status: 'RUNNING',
                duration: 'Background process',
                assigned_to: 'Cassy (QA Agent) - Background process',
                description: 'Continuous background quality validation of payoff statement accuracy.',
                logs: `[13:45] Background quality check initiated
[13:46] Validating payoff statement data
[13:50] Cross-referencing with loan records
[14:00] Checking calculation accuracy
[14:15] 73% validation complete - No issues found`,
                result: {
                    status: 'RUNNING',
                    data: 'Background quality validation 73% complete. No accuracy issues detected so far.'
                }
            },
            'phone-transcription': {
                name: 'Phone Call Transcription',
                agent: '📞 Max',
                status: 'TRANSCRIBING',
                completed_at: 'In Progress',
                sla_status: 'TRANSCRIBING',
                duration: 'Real-time',
                assigned_to: 'Max (Voice Agent) - Dynamic trigger',
                description: 'Dynamic task triggered by incoming phone call requiring real-time transcription.',
                logs: `[14:35] Incoming call detected from (800) 555-0123
[14:35] Caller ID: First National Bank
[14:36] Auto-triggered Max for call transcription
[14:36] Real-time transcription started
[14:37] Processing audio stream...`,
                result: {
                    status: 'TRANSCRIBING',
                    data: 'Real-time transcription active for incoming call from First National Bank.'
                }
            },
            'compliance-monitoring': {
                name: 'Compliance Monitoring',
                agent: '📋 Corey',
                status: 'ACTIVE',
                completed_at: 'Continuous',
                sla_status: 'ACTIVE',
                duration: 'All day',
                assigned_to: 'Corey (Compliance Agent) - Continuous monitoring',
                description: 'Continuous monitoring of TRID compliance deadlines and state-specific requirements.',
                logs: `[09:00] Compliance monitoring started
[09:01] TRID deadline tracking active
[10:00] State requirement validation
[12:00] Midday compliance check - All on track
[14:00] Afternoon deadline review - No issues`,
                result: {
                    status: 'ACTIVE',
                    data: 'All TRID deadlines and state requirements on track. Continuous monitoring active.'
                }
            },
            'wire-instructions': {
                name: 'URGENT: Wire Instructions Changed',
                agent: '💰 Nina',
                status: 'VERIFYING',
                completed_at: 'In Progress',
                sla_status: 'VERIFYING',
                duration: 'Real-time',
                assigned_to: 'Nina (Research Agent) - Dynamic trigger',
                description: 'Dynamic task triggered by updated wire instructions requiring security verification.',
                logs: `[14:50] Email with updated wire instructions received
[14:50] From: buyer's agent with new banking details
[14:51] Auto-triggered Nina for fraud detection
[14:51] Running security verification protocols
[14:52] Analyzing instruction authenticity...`,
                result: {
                    status: 'VERIFYING',
                    data: 'Security verification in progress for updated wire instructions. Fraud detection protocols active.'
                }
            },
            'document-conflict': {
                name: 'Document Version Conflict',
                agent: '📄 Iris',
                status: 'ANALYZING',
                completed_at: 'In Progress',
                sla_status: 'ANALYZING',
                duration: 'Real-time',
                assigned_to: 'Iris (Document Agent) - Dynamic trigger',
                description: 'Dynamic task triggered by conflicting payoff amounts between original and uploaded documents.',
                logs: `[14:32] Document conflict detected between versions
[14:32] Original amount: $247,856.32, New amount: $248,123.45
[14:33] Auto-triggered Iris for conflict analysis
[14:33] Comparing document timestamps and sources
[14:34] Analyzing discrepancy patterns...`,
                result: {
                    status: 'ANALYZING',
                    data: 'Analyzing conflicting payoff amounts between document versions. Difference of $267.13 detected.'
                }
            },
            'email-monitoring': {
                name: 'Email Thread Monitoring',
                agent: '📧 Mia',
                status: 'ACTIVE',
                completed_at: 'Continuous',
                sla_status: 'ACTIVE',
                duration: 'Background process',
                assigned_to: 'Mia (Email Agent) - Continuous monitoring',
                description: 'Continuous monitoring of 4 active email threads for responses and new communications.',
                logs: `[09:00] Email monitoring started for workflow
[14:30] Thread 1: Lender communication - Last activity 1:30 PM
[14:35] Thread 2: HOA correspondence - New message 2:45 PM
[14:40] Thread 3: Title company updates - Active
[14:45] Thread 4: Client inquiries - Monitoring`,
                result: {
                    status: 'ACTIVE',
                    data: 'Monitoring 4 active email threads. 1 new message detected in HOA thread requiring attention.'
                }
            },
            'sla-breach-alert': {
                name: 'URGENT: SLA Breach Alert',
                agent: '⚠️ System',
                status: 'ALERTING',
                completed_at: 'In Progress',
                sla_status: 'ALERTING',
                duration: 'Real-time',
                assigned_to: 'System Alert - Dynamic trigger',
                description: 'Dynamic alert triggered by SLA breach on portal access task requiring immediate attention.',
                logs: `[14:55] SLA breach detected for portal access task
[14:55] Task overdue by 40 minutes
[14:55] Auto-triggered escalation alert
[14:56] Notifying HIL team and managers
[14:56] Escalation protocols activated`,
                result: {
                    status: 'ALERTING',
                    data: 'SLA breach alert active. Portal access task overdue by 40 minutes. HIL team notified.'
                }
            },
            'backup-lender-search': {
                name: 'Backup Lender Search',
                agent: '🔍 Nina',
                status: 'SEARCHING',
                completed_at: 'In Progress',
                sla_status: 'SEARCHING',
                duration: 'Real-time',
                assigned_to: 'Nina (Research Agent) - Dynamic trigger',
                description: 'Dynamic task triggered to find alternative lender contacts due to portal access failure.',
                logs: `[14:20] Portal access failure triggered backup search
[14:21] Searching alternative contact methods
[14:25] Found backup phone number: (800) 555-0124
[14:30] Located secondary email: backup@fnb.com
[14:35] Researching branch office contacts...`,
                result: {
                    status: 'SEARCHING',
                    data: 'Found 2 alternative contact methods. Continuing search for additional backup options.'
                }
            },
            'cost-calculation': {
                name: 'Real-time Cost Calculation',
                agent: '💰 Kosha',
                status: 'CALCULATING',
                completed_at: 'Continuous',
                sla_status: 'CALCULATING',
                duration: 'Background process',
                assigned_to: 'Kosha (Finance Agent) - Background process',
                description: 'Continuous real-time calculation of workflow costs and billable time tracking.',
                logs: `[09:00] Cost tracking initiated for workflow
[12:00] Midday cost update: $125.50
[14:00] Agent time costs updated
[14:30] Document processing costs added
[14:45] Current total: $187.25`,
                result: {
                    status: 'CALCULATING',
                    data: 'Real-time cost tracking active. Current workflow cost: $187.25. Updating continuously.'
                }
            },
            'social-media-monitoring': {
                name: 'Social Media Monitoring',
                agent: '👁️ Ria',
                status: 'SCANNING',
                completed_at: 'Continuous',
                sla_status: 'SCANNING',
                duration: 'Background process',
                assigned_to: 'Ria (Support Agent) - Background monitoring',
                description: 'Continuous monitoring of social media platforms for client mentions and reputation management.',
                logs: `[09:00] Social media monitoring started
[11:30] LinkedIn mention detected - positive
[13:15] Twitter scan - no mentions
[14:20] Facebook review monitoring active
[14:45] No negative mentions detected`,
                result: {
                    status: 'SCANNING',
                    data: 'Social media monitoring active. 1 positive LinkedIn mention detected. No negative sentiment found.'
                }
            },
            'fraud-detection': {
                name: 'URGENT: Fraud Detection Alert',
                agent: '🛡️ Nina',
                status: 'ANALYZING',
                completed_at: 'In Progress',
                sla_status: 'ANALYZING',
                duration: 'Real-time',
                assigned_to: 'Nina (Security Agent) - Dynamic trigger',
                description: 'Dynamic fraud detection alert triggered by suspicious wire instruction pattern.',
                logs: `[14:51] Suspicious pattern detected in wire instructions
[14:51] Multiple changes in short timeframe flagged
[14:52] Auto-triggered fraud analysis protocols
[14:52] Comparing against known fraud patterns
[14:53] Running security verification checks...`,
                result: {
                    status: 'ANALYZING',
                    data: 'Fraud detection analysis in progress. Suspicious wire instruction pattern requires verification.'
                }
            },
            'weather-monitoring': {
                name: 'Weather Impact Monitoring',
                agent: '🌦️ Corey',
                status: 'TRACKING',
                completed_at: 'Continuous',
                sla_status: 'TRACKING',
                duration: 'Background process',
                assigned_to: 'Corey (Compliance Agent) - Background monitoring',
                description: 'Monitoring weather conditions in Miami for potential closing day impact.',
                logs: `[09:00] Weather monitoring started for Miami area
[12:00] Current conditions: Partly cloudy, 78°F
[14:00] Tomorrow forecast: Sunny, 82°F
[14:30] No severe weather alerts
[14:45] Closing day forecast: Clear skies`,
                result: {
                    status: 'TRACKING',
                    data: 'Weather monitoring active. Clear skies forecast for closing day. No weather-related delays expected.'
                }
            },
            'document-backup': {
                name: 'Document Backup & Archive',
                agent: '💾 System',
                status: 'BACKING UP',
                completed_at: 'In Progress',
                sla_status: 'BACKING UP',
                duration: 'Real-time',
                assigned_to: 'System Process - Dynamic trigger',
                description: 'Dynamic backup process triggered to secure critical workflow documents.',
                logs: `[14:45] Critical document backup initiated
[14:46] Backing up payoff statement PDF
[14:47] Archiving email communications
[14:48] Securing research data files
[14:49] Backup progress: 75% complete`,
                result: {
                    status: 'BACKING UP',
                    data: 'Document backup in progress. 75% complete. Securing all critical workflow files.'
                }
            },
            'api-health-check': {
                name: 'API Health Monitoring',
                agent: '🔧 System',
                status: 'HEALTHY',
                completed_at: 'Continuous',
                sla_status: 'HEALTHY',
                duration: 'Background process',
                assigned_to: 'System Monitor - Continuous health check',
                description: 'Continuous monitoring of external API endpoints and system health status.',
                logs: `[09:00] API health monitoring started
[12:00] All APIs responding normally
[14:00] Lender portal API: 200ms response time
[14:30] Email service API: Healthy
[14:45] All systems operational`,
                result: {
                    status: 'HEALTHY',
                    data: 'All external APIs healthy. Average response time: 180ms. No service disruptions detected.'
                }
            },
            'client-escalation': {
                name: 'URGENT: Client Escalation',
                agent: '📞 Ria',
                status: 'ESCALATING',
                completed_at: 'In Progress',
                sla_status: 'ESCALATING',
                duration: 'Real-time',
                assigned_to: 'Ria (Support Agent) - Dynamic trigger',
                description: 'Dynamic escalation triggered by client demanding immediate manager intervention.',
                logs: `[14:58] Client escalation request received
[14:58] Client demanding manager call immediately
[14:59] Auto-triggered escalation workflow
[14:59] Notifying available managers
[15:00] Preparing escalation briefing...`,
                result: {
                    status: 'ESCALATING',
                    data: 'Client escalation in progress. Manager notification sent. Preparing immediate callback.'
                }
            }
        };

        function selectTask(taskId) {
            console.log('Selecting task:', taskId);
            
            // Remove active state from all task items
            document.querySelectorAll('.task-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active state to selected task
            const selectedTask = document.querySelector(`[data-task="${taskId}"]`);
            if (selectedTask) {
                selectedTask.classList.add('active');
            }
            
            // Get task data
            const task = taskData[taskId];
            if (!task) {
                console.error('Task data not found for:', taskId);
                return;
            }
            
            // Update panel header
            const panelHeader = document.querySelector('.task-details-panel .panel-header');
            panelHeader.innerHTML = `
                📋 Task Details
                <span class="panel-count">${task.name}</span>
            `;
            
            // Generate task detail content
            const content = `
                <div class="task-detail-card">
                    <div class="task-detail-header">
                        <div class="task-detail-title">
                            <span class="task-status ${task.status.toLowerCase().replace('_', '-')}"></span>
                            ${task.name}
                        </div>
                        <span class="task-result-status ${task.result.status === 'SUCCESS' ? 'result-success' : task.result.status === 'FAILED' ? 'result-failed' : 'result-review'}">${task.result.status}</span>
                    </div>
                    <div class="task-detail-body">
                        <div class="task-detail-section">
                            <div class="task-detail-subtitle">Task Information</div>
                            <div class="task-detail-grid">
                                <div class="task-detail-item">
                                    <div class="task-detail-label">Agent</div>
                                    <div class="task-detail-value">${task.assigned_to}</div>
                                </div>
                                <div class="task-detail-item">
                                    <div class="task-detail-label">Status</div>
                                    <div class="task-detail-value">${task.status.replace('_', ' ')}</div>
                                </div>
                                <div class="task-detail-item">
                                    <div class="task-detail-label">Completed</div>
                                    <div class="task-detail-value">${task.completed_at}</div>
                                </div>
                                <div class="task-detail-item">
                                    <div class="task-detail-label">Duration</div>
                                    <div class="task-detail-value">${task.duration}</div>
                                </div>
                            </div>
                            <div style="margin-top: 12px;">
                                <div class="task-detail-label">Description</div>
                                <div class="task-detail-value">${task.description}</div>
                            </div>
                        </div>

                        ${task.input_data || task.output_data ? `
                        <div class="task-detail-section">
                            <div class="task-data-tabs">
                                <div class="task-tab-buttons">
                                    ${task.input_data ? '<button class="task-tab-button active" onclick="switchTaskTab(event, \'input\')">Input Data</button>' : ''}
                                    ${task.output_data ? '<button class="task-tab-button' + (!task.input_data ? ' active' : '') + '" onclick="switchTaskTab(event, \'output\')">Output Data</button>' : ''}
                                </div>
                                
                                ${task.input_data ? `
                                <div class="task-tab-content active" id="task-input-tab">
                                    <div class="task-input-form">
                                        ${generateInputForm(task.input_data)}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${task.output_data ? `
                                <div class="task-tab-content${!task.input_data ? ' active' : ''}" id="task-output-tab">
                                    <div class="task-output-form">
                                        ${generateOutputForm(task.output_data)}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="task-detail-section">
                            <div class="task-detail-subtitle">Execution Logs</div>
                            <div class="task-logs">${task.logs}</div>
                        </div>
                        
                        <div class="task-detail-section">
                            <div class="task-detail-subtitle">Result Summary</div>
                            <div class="task-result-data">${task.result.data}</div>
                        </div>
                        
                        ${task.can_open_agent ? `
                        <div class="task-actions">
                            <button class="btn btn-primary" onclick="openAgentModal('${task.agent_modal}')">
                                🔧 Open Agent Interface
                            </button>
                            <button class="btn btn-secondary">🔄 Retry Task</button>
                        </div>
                        ` : task.status === 'PENDING' ? `
                        <div class="task-actions">
                            <button class="btn btn-secondary" onclick="showDependencies('${taskId}')">
                                📋 View Dependencies
                            </button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // Update the task detail content
            const taskDetailContent = document.getElementById('task-detail-content');
            taskDetailContent.innerHTML = content;
        }

        function showDependencies(taskId) {
            const task = taskData[taskId];
            if (task && task.dependencies) {
                alert(`This task depends on:\n${task.dependencies.map(dep => `- ${taskData[dep]?.name || dep}`).join('\n')}\n\nResolve the blocking tasks first.`);
            }
        }

        function switchTab(tabName) {
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabName + '-tab');
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        function switchTaskTab(event, tabType) {
            // Remove active class from all task tab buttons
            const tabContainer = event.target.closest('.task-data-tabs');
            tabContainer.querySelectorAll('.task-tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Hide all task tab content
            tabContainer.querySelectorAll('.task-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected task tab content
            const selectedTab = tabContainer.querySelector(`#task-${tabType}-tab`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        function updateFileTag(select) {
            console.log('File tag updated to:', select.value);
            // Here you would typically save the tag to the database
            // For demo purposes, we'll just show the change
            if (select.value) {
                select.style.background = 'var(--primary-light)';
                select.style.color = 'var(--primary)';
            } else {
                select.style.background = 'var(--bg-tertiary)';
                select.style.color = 'var(--text-secondary)';
            }
        }

        function deleteFile(button) {
            const fileItem = button.closest('.file-item');
            const fileName = fileItem.querySelector('.file-name').textContent;
            
            if (confirm(`Are you sure you want to delete "${fileName}"?\n\nThis action cannot be undone.`)) {
                // Add deletion animation
                fileItem.style.transition = 'all 0.3s ease';
                fileItem.style.opacity = '0';
                fileItem.style.transform = 'translateX(-20px)';
                
                // Remove from DOM after animation
                setTimeout(() => {
                    fileItem.remove();
                }, 300);
                
                console.log('File deleted:', fileName);
                // Here you would typically call an API to delete the file
            }
        }

        function addLender(slotNumber) {
            const form = document.getElementById('add-lender-form');
            form.style.display = 'block';
            form.scrollIntoView({ behavior: 'smooth' });
        }

        function hideAddForm() {
            const form = document.getElementById('add-lender-form');
            form.style.display = 'none';
        }

        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.querySelector('.theme-icon');
            const currentTheme = html.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                html.setAttribute('data-theme', 'light');
                themeIcon.textContent = '🌙';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '☀️';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const html = document.documentElement;
            const themeIcon = document.querySelector('.theme-icon');
            
            html.setAttribute('data-theme', savedTheme);
            if (savedTheme === 'dark') {
                themeIcon.textContent = '☀️';
            } else {
                themeIcon.textContent = '🌙';
            }
        });

        function openAgentModal(agent) {
            console.log('Opening modal for agent:', agent);
            const modalId = agent + '-modal';
            const modal = document.getElementById(modalId);
            
            if (modal) {
                modal.classList.add('active');
                modal.style.display = 'flex';
            } else {
                console.error('Modal not found:', modalId);
            }
        }

        function closeModal(modalId) {
            console.log('Closing modal:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
            }
        }

        // Notes functionality
        function addHilTag(select) {
            const value = select.value;
            const text = select.options[select.selectedIndex].text;
            
            if (value && text) {
                const hilTags = document.querySelector('.hil-tags');
                const existingTags = Array.from(hilTags.querySelectorAll('.tagged-hil')).map(tag => tag.textContent.replace(' ×', ''));
                
                // Check if HIL is already tagged
                if (!existingTags.includes('@' + text.split(' (')[0])) {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'tagged-hil';
                    tagElement.innerHTML = `@${text.split(' (')[0]} <button class="remove-tag" onclick="removeHilTag(this)">×</button>`;
                    hilTags.appendChild(tagElement);
                }
                
                // Reset select
                select.value = '';
            }
        }

        function removeHilTag(button) {
            button.parentElement.remove();
        }

        function clearNote() {
            const noteInput = document.querySelector('.note-input');
            const hilTags = document.querySelector('.hil-tags');
            const prioritySelect = document.querySelector('.priority-select');
            
            noteInput.value = '';
            hilTags.innerHTML = '';
            prioritySelect.value = 'normal';
        }

        function saveNote() {
            const noteInput = document.querySelector('.note-input');
            const noteText = noteInput.value.trim();
            
            if (noteText) {
                console.log('Saving note:', noteText);
                
                // Get tagged HILs
                const taggedHils = Array.from(document.querySelectorAll('.tagged-hil')).map(tag => 
                    tag.textContent.replace(' ×', '')
                );
                
                // Get priority
                const priority = document.querySelector('.priority-select').value;
                
                console.log('Tagged HILs:', taggedHils);
                console.log('Priority:', priority);
                
                // Here you would typically save to database
                // For demo, we'll just show success and clear form
                alert('Note saved successfully!');
                clearNote();
                
                // In a real implementation, you would:
                // 1. POST to /api/workflows/:workflowId/notes
                // 2. Include note text, tagged HILs, priority
                // 3. Refresh the notes feed
            } else {
                alert('Please enter a note before saving.');
            }
        }

        // Gmail-style thread management
        function toggleThread(headerElement) {
            const thread = headerElement.closest('.gmail-thread');
            const threadEmails = thread.querySelector('.thread-emails');
            const toggleIcon = headerElement.querySelector('.thread-toggle');
            
            if (thread.classList.contains('expanded')) {
                // Collapse thread
                thread.classList.remove('expanded');
                threadEmails.style.display = 'none';
                toggleIcon.textContent = '▶';
            } else {
                // Expand thread
                thread.classList.add('expanded');
                threadEmails.style.display = 'block';
                toggleIcon.textContent = '▼';
            }
            
            console.log('Toggled thread:', thread.classList.contains('expanded') ? 'expanded' : 'collapsed');
        }

        function selectEmail(emailElement, emailId) {
            console.log('Selecting email:', emailId);
            
            // Remove active state from all thread emails
            document.querySelectorAll('.thread-email').forEach(email => {
                email.classList.remove('active');
            });
            
            // Add active state to selected email
            emailElement.classList.add('active');
            
            // Update email viewer with selected email content
            // The email content in the main viewer would update here
            console.log('Email selected, would update main viewer with:', emailId);
        }

        // Generate input form HTML from data structure
        function generateInputForm(inputData) {
            if (!inputData) return '<p class="form-empty">No input data available</p>';
            
            let html = '<div class="form-section">';
            
            Object.entries(inputData).forEach(([key, value]) => {
                const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                
                if (typeof value === 'object' && value !== null) {
                    html += `<div class="form-subsection">
                        <div class="form-subsection-title">${label}</div>
                        <div class="form-subsection-content">`;
                    
                    Object.entries(value).forEach(([subKey, subValue]) => {
                        const subLabel = subKey.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                        html += `<div class="form-field">
                            <label class="form-label">${subLabel}</label>
                            <input type="text" class="form-input" value="${subValue || ''}" readonly>
                        </div>`;
                    });
                    
                    html += '</div></div>';
                } else {
                    html += `<div class="form-field">
                        <label class="form-label">${label}</label>
                        <input type="text" class="form-input" value="${value || ''}" readonly>
                    </div>`;
                }
            });
            
            html += '</div>';
            return html;
        }

        // Generate output form HTML from data structure
        function generateOutputForm(outputData) {
            if (!outputData) return '<p class="form-empty">No output data available</p>';
            
            let html = '<div class="form-section">';
            
            Object.entries(outputData).forEach(([key, value]) => {
                const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                
                if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                    html += `<div class="form-subsection">
                        <div class="form-subsection-title">${label}</div>
                        <div class="form-subsection-content">`;
                    
                    Object.entries(value).forEach(([subKey, subValue]) => {
                        const subLabel = subKey.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                        html += `<div class="form-field">
                            <label class="form-label">${subLabel}</label>
                            <input type="text" class="form-input" value="${subValue || ''}" readonly>
                        </div>`;
                    });
                    
                    html += '</div></div>';
                } else if (Array.isArray(value)) {
                    html += `<div class="form-subsection">
                        <div class="form-subsection-title">${label} (${value.length} items)</div>
                        <div class="form-subsection-content">`;
                    
                    value.forEach((item, index) => {
                        if (typeof item === 'object') {
                            html += `<div class="form-array-item">
                                <div class="form-array-title">${label.slice(0, -1)} ${index + 1}</div>`;
                            Object.entries(item).forEach(([itemKey, itemValue]) => {
                                const itemLabel = itemKey.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                                html += `<div class="form-field">
                                    <label class="form-label">${itemLabel}</label>
                                    <input type="text" class="form-input" value="${itemValue || ''}" readonly>
                                </div>`;
                            });
                            html += '</div>';
                        } else {
                            html += `<div class="form-field">
                                <label class="form-label">Item ${index + 1}</label>
                                <input type="text" class="form-input" value="${item || ''}" readonly>
                            </div>`;
                        }
                    });
                    
                    html += '</div></div>';
                } else {
                    html += `<div class="form-field">
                        <label class="form-label">${label}</label>
                        <input type="text" class="form-input" value="${value || ''}" readonly>
                    </div>`;
                }
            });
            
            html += '</div>';
            return html;
        }

        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up events');
            
            // Close modal when clicking outside
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal-overlay')) {
                    event.target.classList.remove('active');
                    event.target.style.display = 'none';
                }
            });

            // Close modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    const activeModal = document.querySelector('.modal-overlay.active');
                    if (activeModal) {
                        activeModal.classList.remove('active');
                        activeModal.style.display = 'none';
                    }
                }
            });
        });
    </script>
</body>
</html>